---
uid: web-forms/overview/deployment/visual-studio-web-deployment/deploying-to-iis
title: 'Веб-развертывание ASP.NET с помощью Visual Studio: развертывание в тестовой среде | Документация Майкрософт'
author: tdykstra
description: В этой серии руководств показано, как развернуть ASP.NET (публикации) веб-приложения, веб-приложениях службы приложений Azure или у стороннего поставщика размещения, Пол...
ms.author: riande
ms.date: 03/23/2015
ms.assetid: 8bf2c4fb-4ee5-4841-bfc2-03462c1f7a7a
msc.legacyurl: /web-forms/overview/deployment/visual-studio-web-deployment/deploying-to-iis
msc.type: authoredcontent
ms.openlocfilehash: ce361d2826733d5ecb9005713993e5ecf7f11860
ms.sourcegitcommit: 45ac74e400f9f2b7dbded66297730f6f14a4eb25
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/16/2018
ms.locfileid: "41827734"
---
<a name="aspnet-web-deployment-using-visual-studio-deploying-to-test"></a>Веб-развертывание ASP.NET с помощью Visual Studio: развертывание в тестовой среде
====================
по [том Дайкстра](https://github.com/tdykstra)

[Загрузите начальный проект](http://go.microsoft.com/fwlink/p/?LinkId=282627)

> В этой серии руководств показано, как развернуть ASP.NET (публикации) веб-приложения для веб-приложениях службы приложений Azure или стороннего поставщика услуг размещения, с помощью Visual Studio 2012 или Visual Studio 2010. Сведения об этой серии см. в разделе [в первом учебнике серии](introduction.md).


## <a name="overview"></a>Обзор

Этом руководстве показано, как развернуть веб-приложения ASP.NET в IIS на локальном компьютере.

При разработке приложения, обычно тестируется путем запуска его в Visual Studio. По умолчанию проекты веб-приложений в Visual Studio 2012 использования IIS Express в качестве веб-сервера разработки. IIS Express поведение во многом напоминает полноценного сервера IIS, чем Visual Studio Development Server (также известном как Cassini), которая по умолчанию использует Visual Studio 2010. Но ни одна из веб-сервера разработки работает так же, как IIS. Таким образом вполне возможно, что приложения будут выполняться правильно при тестировании в Visual Studio, но сбой при развертывании в IIS.

Приложение можно протестировать надежнее следующими способами:

1. Разверните приложение в службах IIS на компьютере разработчика, используя тот же процесс, который будет использоваться в дальнейшем для его развертывания в рабочей среде. Можно настроить Visual Studio для использования IIS при запуске веб-проекта, но это не выполнял бы тестирование процесса развертывания. Этот метод проверяет процесс развертывания в дополнение к проверке, приложение будет работать под управлением служб IIS.
2. Развертывание приложения в тестовую среду, которая практически идентична производственной среды. Поскольку веб-приложений в службе приложений Azure в рабочую среду для этих учебников, идеальный тестовая среда имеет дополнительные веб-приложение, созданное в службе приложений Azure. Это второй веб-приложение будет использовать только для тестирования, но он настраивается так же, как рабочего веб-приложения.

Вариант 2 — это самый надежный способ тестирования, а если этого не нужно обязательно вариант 1. Тем не менее при развертывании для параметра поставщика размещения сторонних 2 может быть нецелесообразным, или может быть дорогостоящим, поэтому в этой серии руководств продемонстрированы оба способа. Вариант 2 описаны в [развертывание в рабочей среде](deploying-to-production.md) руководства.

Дополнительные сведения об использовании веб-серверов в Visual Studio, см. в разделе [веб-серверов в Visual Studio для веб-проектов ASP.NET](https://msdn.microsoft.com/library/58wxa9w5.aspx).

Напоминание: Если что-то не работает, как работать с учебником, вы получаете сообщение об ошибке, не забудьте установить флажок [страница устранения неполадок](troubleshooting.md).

## <a name="install-iis"></a>Установка служб IIS

Для развертывания в IIS на компьютере разработчика, требуются службы IIS и веб-развертывания установлены. Веб-развертывание устанавливается по умолчанию с помощью Visual Studio, но IIS не включается в конфигурации по умолчанию Windows 8 или Windows 7. Если вы уже установили IIS и пул приложений по умолчанию задана .NET 4, перейдите к [разделу](#sqlexpress).

1. С помощью [установщика веб-платформы](https://www.microsoft.com/web/downloads/platform.aspx) является более предпочтительным для установки IIS и веб-развертывания, поскольку установщик веб-платформы устанавливает рекомендуемые конфигурации для служб IIS и она автоматически устанавливает необходимые компоненты для IIS и веб- Развертывание, при необходимости.

    Чтобы запустить установщик веб-платформы для установки IIS и веб-развертывания, используйте следующую ссылку. Если вы уже установили IIS, веб-развертывания или любой из необходимых компонентов для них, установщик веб-платформы устанавливает только что здесь отсутствует.

   - [Установка служб IIS и веб-развертывания с помощью установщика веб-платформы](https://www.microsoft.com/web/gallery/install.aspx?appsxml=&amp;appid=IIS7;ASPNET;NETFramework4;WDeploy)

     Вы увидите сообщения о том, что будут установлены службы IIS 7. Работа ссылку для IIS 8 в Windows 8, но для Windows 8 убедитесь, что ASP.NET 4.5 установлен, выполнив следующие действия:

   - Откройте **панели управления**, **программы и компоненты**, **или отключение компонентов Windows включить**.
   - Разверните **Internet Information Services**, **World Wide Web Services**, и **компоненты разработки приложений**.
   - Убедитесь, что **ASP.NET 4.5** выбран.

      ![Выберите ASP.NET 4.5](deploying-to-iis/_static/image1.png)

После установки служб IIS, запустите **диспетчера служб IIS** чтобы убедиться в том, что пул приложений по умолчанию назначается в .NET Framework версии 4.

1. Нажмите клавиши WINDOWS + R, чтобы открыть **запуска** диалоговое окно.

    (Или в Windows 8 введите «выполнить» на **запустить** странице или в Windows 7 выберите **запуска** из **запустить** меню. Если **запуска** не находится в **запустить** меню, щелкните правой кнопкой мыши на панели задач, щелкните **свойства**выберите **меню "Пуск"** щелкните **Настройка**и выберите **выполните команду**.)
2. Введите «inetmgr» и нажмите кнопку **ОК**.
3. В **подключений** области, разверните узел сервера и выберите **пулы приложений**. В **пулы приложений** области, если **DefaultAppPool** будет назначено .NET framework версии 4, как показано на следующем рисунке, перейдите к следующему разделу.

    [![Inetmgr_showing_4.0_app_pools](deploying-to-iis/_static/image3.png)](deploying-to-iis/_static/image2.png)
4. Если вы видите только два пула приложений, и они задаются в .NET Framework 2.0, необходимо установить ASP.NET 4 в IIS.

    Для Windows 8, см. инструкции в предыдущем разделе для убедившись, что ASP.NET 4.5 устанавливается, или см. в разделе [данной статьи базы Знаний](https://support.microsoft.com/kb/2736284). Для Windows 7, откройте окно командной строки, щелкнув правой кнопкой мыши **командной** в Windows **запустить** меню и выбрав **Запуск от имени администратора**. Затем запустите [aspnet\_regiis.exe](https://msdn.microsoft.com/library/k6h9cz8h.aspx) установить ASP.NET 4 в IIS, с помощью следующих команд. (В 32-разрядных системах, замените «Framework64» с «Платформа»).

    [!code-console[Main](deploying-to-iis/samples/sample1.cmd)]

    Эта команда создает новые пулы приложений для .NET Framework 4, но пул приложений по умолчанию по-прежнему будет указано значение 2.0. Вы будете развертывать приложения, ориентированном на .NET 4 с этим пулом приложений, поэтому вам нужно изменить пул приложений для .NET 4.
5. Если вы закрыли **диспетчера служб IIS**, запустите его снова, раскройте узел сервера и нажмите кнопку **пулы приложений** для отображения **пулы приложений** панель снова.
6. В **пулы приложений** области нажмите кнопку **DefaultAppPool**, а затем в **действия** панели щелкните **основные параметры**.

    [![Inetmgr_selecting_Basic_Settings_for_app_pool](deploying-to-iis/_static/image5.png)](deploying-to-iis/_static/image4.png)
7. В **изменение пула приложений** » диалогового окна «Изменение **версии платформы .NET Framework** для **v4.0.30319 .NET Framework** и нажмите кнопку **ОК**.

    [![Selecting_.NET_4_for_DefaultAppPool](deploying-to-iis/_static/image7.png)](deploying-to-iis/_static/image6.png)

IIS теперь готов для публикации веб-приложения к ней, но прежде чем это можно сделать, необходимо создание баз данных, которые будут использоваться в тестовой среде.

<a id="sqlexpress"></a>

## <a name="install-sql-server-express"></a>Установка SQL Server Express

LocalDB не предназначен для работы со службами IIS, поэтому для тестовой среды, необходимо иметь установки SQL Server Express. Если вы используете Visual Studio 2010 SQL Server Express уже установлен по умолчанию. Если вы используете Visual Studio 2012, необходимо установить его.

Чтобы установить SQL Server Express, установите его из [центра загрузки: Microsoft SQL Server 2012 Express](https://www.microsoft.com/download/details.aspx?id=29062) , щелкнув [ENU\x64\SQLEXPR\_x64\_ENU.exe](https://download.microsoft.com/download/8/D/D/8DD7BDBA-CEF7-4D8E-8C16-D9F69527F909/ENU/x64/SQLEXPR_x64_ENU.exe) или [ ENU\x86\SQLEXPR\_x86\_ENU.exe](https://download.microsoft.com/download/8/D/D/8DD7BDBA-CEF7-4D8E-8C16-D9F69527F909/ENU/x86/SQLEXPR_x86_ENU.exe). При выборе другой для вашей системы его не удается установить, и вы можете попробовать другой.

На первой странице Центр установки SQL Server, нажмите кнопку **автономная установка нового SQL Server или добавление компонентов к существующей установке**и следуйте инструкциям, принимая параметры по умолчанию. В мастере установки примите параметры по умолчанию. Дополнительные сведения о параметрах установки см. в разделе [Установка SQL Server 2012 с помощью мастера установки (программа установки)](https://msdn.microsoft.com/library/ms143219.aspx).

## <a name="create-sql-server-express-databases-for-the-test-environment"></a>Создание баз данных на SQL Server Express для тестовой среды

Приложение университета Contoso имеет две базы данных: базы данных членства и базы данных приложения. Эти базы данных можно развернуть две отдельные базы данных или в одной базе данных. Может потребоваться объединить их для упрощения базы данных соединения между вашей базы данных приложения и базы данных членства. Если вы развертываете стороннего поставщика услуг размещения, план размещения также может указать причину их объединение. Например поставщика услуг размещения может взимать плату сведения для нескольких баз данных или даже не поддерживают более одной базы данных.

В этом руководстве вы развернете для двух баз данных в тестовой среде и для одной базы данных в промежуточной и рабочей средах.

Из **представление** меню в Visual Studio выберите **обозревателя серверов** (**обозреватель баз данных** в Visual Web Developer) и щелкните правой кнопкой мыши **подключения к данным**  и выберите **создать новую базу данных SQL Server**.

![Selecting_Create_New_SQL_Server_Database](deploying-to-iis/_static/image8.png)

В **создать новую базу данных SQL Server** диалогового окна введите «. \SQLExpress» в **имя_сервера** поле и «aspnet-ContosoUniversity» в **новое имя базы данных** поле, затем Нажмите кнопку **ОК**.

![Создание aspnet ContosoUniversity](deploying-to-iis/_static/image9.png)

Выполните ту же процедуру, чтобы создать новую базу данных SQL Server Express School с именем «ContosoUniversity».

**Обозреватель серверов** теперь отображаются два новых баз данных.

![Новые базы данных в обозревателе серверов](deploying-to-iis/_static/image10.png)

## <a name="create-a-grant-script-for-the-new-databases"></a>Создание скрипта предоставления доступа для новых баз данных

При выполнении приложения в службах IIS на компьютере разработчика, приложение обращается к базе данных, используя учетные данные пула приложений по умолчанию. Тем не менее по умолчанию удостоверение пула приложений имеет разрешение на открытие баз данных. Так что вам нужно запустить сценарий предоставлять ему такое разрешение. В этом разделе описано создание скрипта, что вы запустите более поздней версии, чтобы убедиться в том, что приложение можно открыть баз данных, когда оно работает в IIS.

Щелкните правой кнопкой мыши решение (не из проектов), а затем нажмите кнопку **Добавление нового элемента**, а затем создайте новый **файл SQL** с именем *Grant.sql*. Скопируйте следующие команды SQL в файл, а затем сохраните и закройте файл:

[!code-sql[Main](deploying-to-iis/samples/sample2.sql)]

> [!NOTE]
> Этот сценарий предназначен для работы с SQL Server Express 2012 и параметры IIS в Windows 8 или Windows 7, как они указаны в этом руководстве. При использовании другой версии SQL Server или Windows или если вы настроили IIS на компьютере по-разному, изменения в этот сценарий может потребоваться. Дополнительные сведения о сценарии SQL Server, см. в разделе [SQL Server Books Online](https://go.microsoft.com/fwlink/?LinkId=132511).


> [!NOTE] 
> 
> **Примечание по безопасности** этот сценарий дает db\_права владельца для пользователя, который обращается к базе данных во время выполнения, который является то, что вы в рабочей среде. В некоторых сценариях может потребоваться указать пользователя, имеющего схемы всей базы данных, обновить разрешения только для развертывания и указать во время выполнения другого пользователя с разрешениями только для чтения и записи данных. Дополнительные сведения см. в разделе [просмотрите автоматического изменения в файл Web.config для Code First Migrations](#reviewingmigrations) далее в этом учебнике.


<a id="publish"></a>

## <a name="run-the-grant-script-in-the-application-database"></a>Запустите сценарий grant в базе данных приложения

Можно настроить профиль публикации для запуска скрипта grant в базе данных членства во время развертывания, так как это развертывание базы данных использует поставщик dbDacFx. Не может выполнять скрипты во время развертывания Code First Migrations, который является, как вы развертываете базы данных приложения. Таким образом необходимо вручную запустить скрипт перед развертыванием в базе данных приложения.

1. В Visual Studio откройте *Grant.sql* файл, который был создан ранее.
2. Нажмите кнопку **Подключиться**. 

    ![Кнопка "Подключить"](deploying-to-iis/_static/image11.png)
3. В **соединение с сервером** диалогового окна введите *. \SQLExpress* как **имя сервера**, а затем нажмите кнопку **Connect**.
4. В раскрывающемся списке баз данных выберите **ContosoUniversity**, а затем нажмите кнопку **Execute**. 

    ![](deploying-to-iis/_static/image12.png)

Удостоверение пула приложений по умолчанию теперь имеет достаточные разрешения в базе данных приложения для Code First Migrations для создания таблиц базы данных при запуске приложения.

## <a name="publish-to-iis"></a>Публикация в IIS

Существует несколько способов, которые можно развернуть с помощью Visual Studio и веб-развертывания IIS:

- С помощью Visual Studio, публикация одним щелчком.
- Публикация из командной строки.
- Создание *пакет развертывания* и установить его с помощью пользовательского интерфейса диспетчера IIS. Пакет развертывания состоит из *ZIP-файл* файл, содержащий все файлы и метаданные, необходимые для установки сайта в IIS.
- Создание пакета развертывания и установить его с помощью командной строки.

Процесс, который вы выполнили в предыдущих учебных курсах, чтобы настроить Visual Studio для автоматизации задач развертывания применяется ко всем из этих методов. В этих учебниках вы используете первые два из этих методов. Для получения сведений о пакетах развертывания, см. в разделе [развертывание веб-приложения необходимо создать и установить пакет веб-развертывания](https://go.microsoft.com/fwlink/p/?LinkId=282413#package) в веб-развертывания содержимого карты для Visual Studio и ASP.NET.

Перед публикацией, убедитесь, что Visual Studio выполняется в режиме администратора. Если вы не видите **(администратор)** в заголовке окна, закройте Visual Studio. В Windows 8 **запустить** страницы или Windows 7 **запустить** меню, щелкните правой кнопкой мыши значок для версии Visual Studio, вы используете и выберите **Запуск от имени администратора**. Режим администратора является обязательным для публикации, только когда вы публикуете в службах IIS на локальном компьютере.

### <a name="create-the-publish-profile"></a>Создание профиля публикации

1. В **обозревателе решений**, щелкните правой кнопкой мыши проект ContosoUniversity (не проект ContosoUniversity.DAL) и выберите **публикации**.

    **Веб-публикации** откроется мастер.

    ![Публикация веб-мастера профиля tab](deploying-to-iis/_static/image13.png)
2. В раскрывающемся списке выберите  **&lt;New... &gt;**. (В последнем обновлении Visual Studio установлен, не стрелку раскрывающегося списка, и кнопка для создания нового профиля с нуля **Custom**.)
3. В **новый профиль** диалоговое окно, введите «Test» и нажмите кнопку **ОК**.

    Мастер автоматически переходит к **подключения** вкладки.
4. В **URL-адрес службы** введите *localhost*.
5. В **сайт и приложение** введите *веб-сайт по умолчанию/ContosoUniversity*
6. В **URL-адрес назначения** введите `http://localhost/ContosoUniversity`

    **URL-адрес назначения** параметр не требуется. Когда Visual Studio завершит развертывание приложения, автоматически откроется браузер по умолчанию этот URL-адрес. Если вы не хотите в браузере открывается автоматически после развертывания, оставьте это поле пустым.
7. Нажмите кнопку **проверить подключение** для убедитесь, что параметры указаны правильно, и можно подключиться к службам IIS на локальном компьютере.

    Зеленая галочка проверяет, что подключение выполнено успешно.

    ![Публикация веб-tab, мастер подключения](deploying-to-iis/_static/image14.png)
8. Нажмите кнопку **Далее** для перехода к **параметры** вкладки.
9. **Конфигурации** раскрывающемся списке указывает конфигурацию сборки для развертывания. Оставьте значение по умолчанию выпуска. Вы не развертывать отладочных сборок в этом руководстве.
10. Разверните **параметры публикации файлов**, а затем выберите **исключить файлы из приложения\_папка данных**.

    В тестовой среде, приложение будет получать доступ к базе данных, созданные в локальном экземпляре SQL Server Express, файлы не MDF-файл в *приложения\_данных* папки.
11. Оставьте **Precompile во время публикации** и **удалять дополнительные файлы в месте назначения** флажки.

    ![Параметры публикации файлов на вкладке "Параметры"](deploying-to-iis/_static/image15.png)

    Предварительная компиляция — это параметр, который предназначен главным образом для очень больших узлах; он может сократить время запуска страницы при первом запросе страницы после публикации сайта.

    Удалять дополнительные файлы, так как это первый развертывания и не будет все файлы в папке назначения еще не нужно.

    > [!NOTE] 
    > 
    > [!CAUTION]
    > При выборе **удалять дополнительные файлы** для последующего развертывания на том же сайте, убедитесь, что использовать эту предварительную версию функции, чтобы увидеть заранее какие файлы будут удалены перед развертыванием. Ожидаемым поведением является то, что веб-развертывания приведет к удалению файлов на целевом сервере, удаленные в проекте. Тем не менее сравнивается структуры всю папку в исходной и целевой папки, и в некоторых сценариях веб-развертывания может удалить файлы, которые вы не хотите удалить.
    > 
    > Например если у вас есть веб-приложение во вложенной папке на сервере при развертывании проекта в корневую папку, будут удалены во вложенную папку. Возможно, один проект для основного сайта в домене contoso.com, а второй проект для блог по адресу contoso.com/blog. Приложение блога находится во вложенной папке. При выборе удалить дополнительные файлы в месте назначения, при развертывании основного сайта, блога приложения будут удалены.
    > 
    > Еще один пример: приложение\_папка данных могут быть неожиданно удалены. Определенные базы данных, таких как SQL Server Compact хранить файлы базы данных в приложении\_папку данных. После первоначального развертывания вы не хотите сохранять копирование файлов базы данных в последующих развертываниях, выбираем исключить приложение\_данных на вкладке "Упаковка и публикация Web". После этого, если у вас есть удалить дополнительные файлы в месте назначения выбран, файлы базы данных и приложения\_самой папке данных будут удалены следующий раз при публикации.

### <a name="configure-deployment-for-the-membership-database"></a>Настройка развертывания для базы данных членства

Приведенные ниже инструкции относятся к **DefaultConnection** базы данных в **баз данных** раздел диалогового окна.

1. В **строку подключения к удаленному** введите следующую строку соединения, указывающий на базе членства SQL Server Express.

    [!code-console[Main](deploying-to-iis/samples/sample3.cmd)]

    Процесс развертывания будет поместить эту строку подключения в развернутый файл Web.config, поскольку **использовать эту строку подключения во время выполнения** выбран.

    Также можно получить строку подключения из **обозревателя серверов**. В **обозревателя серверов**, разверните **подключения к данным** и выберите  **&lt;machinename&gt;\sqlexpress.aspnet-ContosoUniversity** базы данных, а затем из **свойства** окно копирования **строку подключения** значение. Что строка подключения будет иметь один дополнительный параметр, который можно удалить: `Pooling=False`.
2. Выберите **обновления базы данных**.

    В результате будет создан в целевой базе данных во время развертывания схемы базы данных. В следующих шагах укажите дополнительные сценарии, которые необходимы для запуска: один для предоставления доступа к базе данных в пуле приложений по умолчанию, а для развертывания данных.
3. Нажмите кнопку **настроить обновление базы данных**.
4. В **Настройка обновления базы данных** диалоговом окне щелкните **добавить скрипт SQL** и перейдите к *Grant.sql* скрипт, который был ранее сохранен в папке решения.
5. Повторите процедуру, чтобы добавить *aspnet-data-dev.sql* скрипта.

    ![Настройка обновления базы данных для базы данных членства](deploying-to-iis/_static/image16.png)
6. Нажмите кнопку **Закрыть**.

### <a name="configure-deployment-for-the-application-database"></a>Настройка развертывания для базы данных приложения

Когда Visual Studio обнаруживает Entity Framework `DbContext` класс, он создает запись в **баз данных** раздел с **выполнить Code First Migrations** флажок вместо  **Обновить базу данных** "флажок". В этом руководстве вы используете этот флажок для указать развертывание Code First Migrations.

В некоторых сценариях, возможно, вы используете `DbContext` базы данных, но вы хотите использовать поставщик dbDacFx вместо миграции для развертывания базы данных. В этом случае см. в разделе [как развернуть базу данных Code First без миграции?](https://msdn.microsoft.com/library/ee942158.aspx#deploy_code_first_without_migrations) в ASP.NET Web Deployment вопросы и ответы по на сайте MSDN.

Приведенные ниже инструкции относятся к **SchoolContext** базы данных в **баз данных** раздел диалогового окна.

1. В **строку подключения к удаленному** введите следующую строку соединения, указывающий на базе приложения SQL Server Express.

    [!code-console[Main](deploying-to-iis/samples/sample4.cmd)]

    Процесс развертывания будет поместить эту строку подключения в развернутый файл Web.config, поскольку **использовать эту строку подключения во время выполнения** выбран.

    Также можно получить строку подключения базы данных приложения из **обозревателя серверов** так же, как у вас есть членство базы данных строку подключения.
2. Выберите **выполнить Code First Migrations (при запуске приложения)**.

    Этот параметр вызывает завершение процесса развертывания для настройки развернутый файл Web.config для указания `MigrateDatabaseToLatestVersion` инициализатор. Это инициализатор автоматически обновляет базу данных до последней версии, когда приложение получает доступ к базе данных в первый раз после развертывания.

### <a name="configure-publish-profile-transforms"></a>Настройка преобразования профиля публикации

1. Нажмите кнопку **закрыть**, а затем нажмите кнопку **Да** при появлении, если вы хотите сохранить изменения.
2. В **обозревателе решений**, разверните **свойства**, разверните **PublishProfiles**.
3. Щелчком Rright *Test.pubxml,* и нажмите кнопку **добавить преобразования конфигурации**.

    ![Преобразование конфигурации меню "Добавить"](deploying-to-iis/_static/image17.png)

    Visual Studio создает *Web.Test.config* файла преобразования и открывает его.
4. В *Web.Test.config* файл преобразования, вставьте следующий код сразу после открывающего тега конфигурации.

    [!code-xml[Main](deploying-to-iis/samples/sample5.xml)]

    При использовании теста профиль публикации, это преобразование задает индикатор среды «Test». Развернутого веб-сайта («Test») появится после заголовок H1 «Contoso University».
5. Сохраните и закройте файл.
6. Щелкните правой кнопкой мыши *Web.Test.config* файл и нажмите кнопку **преобразования предварительной версии** чтобы убедиться в том, что преобразование коде создает необходимые изменения.

    **Web.config предварительной версии** окна показан результат применения обоих *Web.Release.config* преобразует и *Web.Test.config* преобразования.

### <a name="preview-the-deployment-updates"></a>Предварительный просмотр обновлений развертывания

1. Откройте **веб-публикации** еще раз мастер (проект ContosoUniversity правой кнопкой мыши и нажмите кнопку **публикации**).
2. В **предварительной версии** вкладке, убедитесь, что **теста** профиль является снимая выделение, а затем щелкните **начать просмотр** для просмотра списка файлов, которые будут скопированы.

    ![Кнопка предварительного просмотра](deploying-to-iis/_static/image18.png)

    ![Предварительный просмотр публикации](deploying-to-iis/_static/image19.png)

    Можно также щелкнуть **предварительной версии базы данных** ссылку, чтобы просмотреть скрипты, которые будут выполняться в базе данных членства. (Скрипты не выполняются для развертывания Code First Migrations, поэтому нет ничего для предварительного просмотра для базы данных приложения.)
3. Нажмите кнопку **Опубликовать**.

    Если Visual Studio не находится в режиме администратора, может появиться сообщение об ошибке, указывающее ошибку. В этом случае закройте Visual Studio, откройте его в режиме администратора и повторите попытку публикации.

    Если Visual Studio находится в режиме администратора, **вывода** отчеты окно успешной сборки и публикации.

    ![Output_window_publish_Test](deploying-to-iis/_static/image20.png)

    Если вы ввели URL-адрес в **URL-адрес назначения** поле в профиле публикации **подключения** вкладке в браузере автоматически откроется на Contoso University домашнюю страницу, на сервере IIS на локальном компьютере.

## <a name="test-in-the-test-environment"></a>В среде тестирования

Обратите внимание на то, что среда индикатор отображает «(тест)» вместо «(Dev)», который показывает, что *Web.config* выполнено преобразование для индикатора среды.

Запустите **преподавателей** страницу, чтобы убедиться, что Code First заполнена начальными значениями базу данных данными преподавателя. Если выбрать эту страницу, может занять несколько минут, чтобы загрузить, так как Code First создает базу данных и затем запускает `Seed` метод. (Ничего не произошло, когда вы были на домашней странице, так как приложение не пытается получить доступ к базе данных еще.)

Нажмите кнопку **учащихся** tab, чтобы убедитесь, что развернутая база данных не учащихся.

Выберите **добавить учащихся** из **учащихся** меню, добавить учащихся, а затем просмотрите нового учащегося в **учащихся** страницу, чтобы убедиться, что вы можете успешно записи в базу данных .

Из **курсы** меню, выберите **обновления кредиты**. **Кредиты обновления** страницы требуются права администратора, поэтому **вход** откроется страница. Введите учетные данные учетной записи администратора, что вы создали ранее («admin» и «devpwd»). **Обновления кредиты** отображается страница, которая проверяет, что учетную запись администратора, созданную в предыдущем учебном курсе был правильно развернут в тестовую среду.

Убедитесь, что *Elmah* папка существует в *c:\inetpub\wwwroot\ContosoUniversity* папку с файлом заполнитель только в ней.

<a id="reviewingmigrations"></a>

## <a name="review-the-automatic-webconfig-changes-for-code-first-migrations"></a>Просмотрите автоматического изменения Web.config для Code First Migrations

Откройте *Web.config* файл в развернутом приложении в *C:\inetpub\wwwroot\ContosoUniversity* и вы увидите, где процесс развертывания автоматически настроить Code First Migrations для Обновите базу данных до последней версии.

![](deploying-to-iis/_static/image21.png)

Процесс развертывания, также создается новая строка подключения для Code First Migrations для использования исключительно для обновления схемы базы данных:

![Строка подключения Database_Publish](deploying-to-iis/_static/image22.png)

Эта строка дополнительные подключения можно указать одну учетную запись пользователя для обновления схемы баз данных и учетной записи другого пользователя для доступа к данным приложения. Например, можно назначить **db\_владельца** роли для Code First Migrations и **db\_datareader** и **db\_datawriter**роли для приложения. Это общий шаблон защиты в глубину, не позволяющая потенциально вредоносного кода в приложении изменять схему базы данных. (Например, это может произойти в успешной атаки путем внедрения кода SQL.) Этот шаблон не используется в этих учебниках. Если вы хотите реализовать этот шаблон в рамках сценария, его можно сделать, выполнив следующие действия:

1. В **параметры** вкладке **веб-публикации** мастер, введите строку подключения, задающий пользователя с помощью разрешений на обновление схемы базы данных полный и очистить **использовать эту строку подключения во время выполнения** "флажок". В развернутый файл Web.config, это становится `DatabasePublish` строку подключения.
2. Создайте преобразование файла Web.config для строки подключения, приложение для использования во время выполнения.

## <a name="summary"></a>Сводка

Вы развернули приложение в службах IIS на компьютере разработчика и протестировали его там.

![Домашняя страница в тесте](deploying-to-iis/_static/image23.png)

Это подтверждает, что процесс развертывания копируются содержимое приложения в нужном направлении (за исключением файлов, которые вы не хотите развернуть), а также этой веб-развертывания настроен IIS во время развертывания. В следующем руководстве вы выполните еще один тест, который находит задачу развертывания, которая еще не было сделано: Установка разрешений для папки на *Elmah* папки.

## <a name="more-information"></a>Дополнительные сведения

Сведения о запуске IIS или IIS Express в Visual Studio см. следующие ресурсы:

- [Обзор IIS Express](https://www.iis.net/learn/extensions/introduction-to-iis-express/iis-express-overview) на веб-узле IIS.net.
- [Знакомство с IIS Express](https://weblogs.asp.net/scottgu/archive/2010/06/28/introducing-iis-express.aspx) в блоге Скотта Гатри.
- [Веб-серверы в Visual Studio для проектов ASP.NET Web](https://msdn.microsoft.com/library/58wxa9w5.aspx).
- [Основные различия между IIS и ASP.NET Development Server](../../older-versions-getting-started/deploying-web-site-projects/core-differences-between-iis-and-the-asp-net-development-server-cs.md) на веб-сайте ASP.NET.

Сведения о проблемах могут возникнуть при запуске приложения в среднем уровне доверия, см. в разделе [размещения приложений ASP.NET в средний уровень доверия](http://www.4guysfromrolla.com/articles/100307-1.aspx) на 4 ребята из Rolla сайта.

> [!div class="step-by-step"]
> [Назад](project-properties.md)
> [Вперед](setting-folder-permissions.md)
