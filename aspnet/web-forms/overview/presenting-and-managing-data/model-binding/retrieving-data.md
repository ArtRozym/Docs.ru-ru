---
uid: web-forms/overview/presenting-and-managing-data/model-binding/retrieving-data
title: Извлечение и отображение данных с помощью модели привязки и веб-форм | Документация Майкрософт
author: Rick-Anderson
description: В этой серии руководств показано основными аспектами с помощью привязки модели с проектом веб-форм ASP.NET. Привязка модели позволяет взаимодействие с данными более прямой-...
ms.author: riande
ms.date: 02/27/2014
ms.assetid: 9f24fb82-c7ac-48da-b8e2-51b3da17e365
msc.legacyurl: /web-forms/overview/presenting-and-managing-data/model-binding/retrieving-data
msc.type: authoredcontent
ms.openlocfilehash: b05f3780d7c4e4734b35c0d9377a89d6f3edb0f8
ms.sourcegitcommit: 2d3e5422d530203efdaf2014d1d7df31f88d08d0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/05/2018
ms.locfileid: "51021343"
---
<a name="retrieving-and-displaying-data-with-model-binding-and-web-forms"></a>Извлечение и отображение данных с помощью привязки модели и веб-форм
====================
по [Tom FitzMacken](https://github.com/tfitzmac)

> В этой серии руководств показано основными аспектами с помощью привязки модели с проектом веб-форм ASP.NET. Привязка модели упрощает взаимодействие с данными более эффективную чем работа с данными объектов источника (например, элемент управления ObjectDataSource и SqlDataSource). Эта серия начинается с вводный материал и перемещает до более продвинутых в последующих руководствах.
> 
> Шаблон привязки модели работает с любой технологии доступа к данным. В этом руководстве используется платформа Entity Framework, но можно использовать технологии доступа к данным, который наиболее вам знакомы. Из элемента управления с привязкой к данным сервера, например в элементе управления GridView, ListView, DetailsView и FormView укажите имена методов для выбора, обновления, удаления и создания данных. В этом руководстве вы укажете значение для SelectMethod.
> 
> В этом методе обеспечивают логику для получения данных. В следующем учебном курсе UpdateMethod и InsertMethod и DeleteMethod установит значения.
> 
> Вы можете [загрузить](https://go.microsoft.com/fwlink/?LinkId=286116) весь проект полностью на C# или Visual Basic. Загружаемый код работает с Visual Studio 2012 или Visual Studio 2013. Он использует шаблон Visual Studio 2012, который немного отличается от шаблона Visual Studio 2013, в этом учебнике.
> 
> В этом руководстве вы запустите приложение в Visual Studio. Вы можете также сделать приложение доступным через Интернет, развернув ее у поставщика услуг размещения. Корпорация Майкрософт предлагает бесплатные услуг хостинга до 10 веб-сайтов в  
>  [бесплатную пробную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A443DD604). Сведения о развертывании веб-проекта Visual Studio веб-приложениях службы приложений Azure, см. в разделе [веб-развертывание ASP.NET с помощью Visual Studio](../../deployment/visual-studio-web-deployment/introduction.md) рядов. Этот учебник также показано, как использовать Entity Framework Code First Migrations для развертывания базы данных SQL Server в базу данных SQL Azure.
> 
> ## <a name="software-versions-used-in-the-tutorial"></a>Версии программного обеспечения, используемые в этом руководстве
> 
> 
> - Microsoft Visual Studio 2013 или Microsoft Visual Studio Express 2013 для Web
>   
> 
> Этот учебник также работает с Visual Studio 2012, но некоторые отличия в пользовательский интерфейс и проекта шаблон.


## <a name="what-youll-build"></a>Вы создадите

В этом руководстве вам потребуется:

1. Создание объектов данных, которые отражают университет с студентов, зачисленных на курсы
2. Построение таблиц базы данных из объектов
3. Заполнение базы данных тестовыми данными
4. Отображение данных в веб-формы

## <a name="set-up-project"></a>Настройка проекта

В Visual Studio 2013, создайте новый **веб-приложение ASP.NET** вызывается **ContosoUniversityModelBinding**.

![Создание проекта](retrieving-data/_static/image2.png)

Выберите шаблон веб-форм и оставьте значения по умолчанию. Нажмите кнопку ОК, чтобы настроить проект.

![Выберите веб-форм](retrieving-data/_static/image3.png)

Во-первых вы внесете ряд небольшие изменения в настройки внешнего вида узла. Откройте **Site.Master** файл и измените заголовок на включают университета Contoso вместо Мое приложение ASP.NET.

[!code-aspx[Main](retrieving-data/samples/sample1.aspx?highlight=1)]

Затем измените текст заголовка из **имя_приложения** для **университета Contoso**.

[!code-aspx[Main](retrieving-data/samples/sample2.aspx?highlight=7)]

Также в Site.Master, измените ссылки навигации, отображаются в заголовке, чтобы отразить на страницах, которые относятся к этому сайту. Вам не потребуется либо **о** страницы или **контакт** странице, чтобы удалить эти связи. Вместо этого необходимо будет ссылку, чтобы страница с именем **учащихся**. Эта страница еще не создана.

[!code-aspx[Main](retrieving-data/samples/sample3.aspx)]

Сохраните и закройте Site.Master.

Теперь вы создадите веб-формы для отображения данных об учащихся. Щелкните правой кнопкой мыши проект, и **добавить** **новый элемент**. Выберите **веб-форма с главной страницы** шаблона и назовите его **Students.aspx**.

![Создание страницы](retrieving-data/_static/image5.png)

Выберите **Site.Master** как на главную страницу для новой веб-формы.

## <a name="create-the-data-models-and-database"></a>Создание модели данных и базы данных

Code First Migrations будет использовать для создания объектов и соответствующие таблицы базы данных. Эти таблицы будут храниться сведения об учащихся и их курсы.

В папке Models, добавьте новый класс с именем **UniversityModels.cs**.

![Создание класса модели](retrieving-data/_static/image7.png)

В этом файле определите классы SchoolContext, учащихся, регистрации и курс следующим образом:

[!code-csharp[Main](retrieving-data/samples/sample4.cs)]

Класс SchoolContext является производным от DbContext, который управляет подключения к базе данных и изменения в данных.

В классе учащегося, обратите внимание, что атрибуты, которые были применены к **FirstName**, **LastName**, и **год** свойства. Эти атрибуты будут использоваться для проверки данных в этом руководстве. Чтобы упростить код для этой демонстрации проекта, эти свойства были помечены как с атрибутами проверки данных. В реальном проекте можно применить атрибуты проверки для всех свойств, которые должны проверенные данные, такие как свойства в классах регистрации и курса.

Сохраните UniversityModels.cs.

Чтобы настроить базу данных, на основе этих классов будет использовать средства Code First Migrations.

В **консоль диспетчера пакетов**, выполните команду:  
`enable-migrations -ContextTypeName ContosoUniversityModelBinding.Models.SchoolContext`

Если команда завершается успешно, вы получите сообщение о том, что включили миграции

![выполняет миграцию](retrieving-data/_static/image8.png)

Обратите внимание, что новый файл с именем **Configuration.cs** будет создана. В Visual Studio этот файл автоматически открывается после его создания. Содержит класс конфигурации **начальное значение** метод, который позволяет предварительно заполнить таблицы базы данных тестовыми данными.

Добавьте следующий код в метод начальное значение. Вам потребуется добавить **с помощью** инструкции для **ContosoUniversityModelBinding.Models** пространства имен.

[!code-csharp[Main](retrieving-data/samples/sample5.cs)]

Сохраните Configuration.cs.

В консоли диспетчера пакетов выполните команду `add-migration initial`.

Выполните команду `update-database`.

Появление исключения при выполнении этой команды, это возможно, что значения StudentID и CourseID имеют различные из значения в метод заполнения. Откройте эти таблицы в базе данных и найдите существующие значения для StudentID и CourseID. Добавьте эти значения в коде для заполнения таблицы регистрации.

Файл базы данных был добавлен, но в настоящее время он скрыт в проекте. Нажмите кнопку **Показать все файлы** для отображения файла.

![Показать все файлы](retrieving-data/_static/image10.png)

Обратите внимание на то, MDF-файл появится в приложении\_папку данных.

![файл базы данных](retrieving-data/_static/image12.png)

Дважды щелкните файл MDF-файл и откройте обозреватель серверов. Теперь существуют и таблицы заполняются данными.

![таблицы баз данных](retrieving-data/_static/image14.png)

## <a name="display-data-from-students-and-related-tables"></a>Отображение данных из связанных таблиц и учащихся

С данными в базе данных теперь вы готовы для получения этих данных и отображения его на веб-странице. Вы воспользуетесь **GridView** управления для отображения данных в столбцах и строках.

Откройте Students.aspx и найдите **MainContent** заполнителя. В рамку, добавьте **GridView** элемент управления, который включает следующий код.

[!code-aspx[Main](retrieving-data/samples/sample6.aspx)]

Существует несколько важных понятий в этом коде разметки, вам необходимо обратить внимание. Во-первых, обратите внимание, что значение установлено для **SelectMethod** свойства в элементе GridView. Это значение задает имя метода, который используется для получения данных для элемента GridView. На следующем шаге вы создадите этот метод. Во-вторых, обратите внимание, что **ItemType** свойство имеет значение класса Student, созданную ранее. Установив это значение, могут ссылаться на свойства этого класса в коде разметки. Например класс Student содержит коллекцию с именем регистрациями. Можно использовать **Item.Enrollments** для извлечения этой коллекции и затем использовать синтаксис LINQ для получения суммы зарегистрированного деньги на счете для каждого учащегося.

В файле кода, необходимо добавить метод, который указан для **SelectMethod** значение. Откройте **Students.aspx.cs**и добавьте **с помощью** инструкций для **ContosoUniversityModelBinding.Models** и **System.Data.Entity**пространства имен.

[!code-csharp[Main](retrieving-data/samples/sample7.cs)]

Затем добавьте следующий метод. Обратите внимание на то, что имя этого метода соответствует имени, которое вы указали для SelectMethod.

[!code-csharp[Main](retrieving-data/samples/sample8.cs)]

**Include** предложение улучшает производительность запроса, но не очень важен для запросов для работы. Без предложения Include данные следует получить с помощью отложенной загрузки, которая используется для отправки связанных отдельный запрос к базе данных каждый раз, что данные извлекаются. Предоставляя предложения Include, данные извлекаются с помощью Безотложная загрузка, значит, все связанные данные извлекается с помощью одного запроса базы данных. В случаях, когда большая часть связанные данные не используется, упреждающая загрузка может привести к снижению эффективности так, как получить дополнительные данные. Тем не менее в этом случае Безотложная загрузка обеспечивает наилучшую производительность поскольку взаимосвязанные данные отображаются для каждой записи.

Дополнительные сведения о производительности следует учитывать при загрузке связанных данных, см. в разделе **Lazy Eager и явная загрузка связанных данных** в [чтение связанных данных с помощью Entity Framework в ASP Приложение .NET MVC](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/reading-related-data-with-the-entity-framework-in-an-asp-net-mvc-application.md) раздела.

По умолчанию данные сортируются по значениям свойства, помеченного как ключ. Можно добавить предложение OrderBy, чтобы указать другое значение для сортировки. В этом примере свойство StudentID по умолчанию используется для сортировки. В [сортировка, разбиение по страницам и фильтрация данных](sorting-paging-and-filtering-data.md) разделе позволит пользователю выбрать столбец для сортировки.

Запустите веб-приложение и перейдите на страницу учащихся. На страницу учащихся отображаются следующие сведения учащегося.

![Отображение данных](retrieving-data/_static/image16.png)

## <a name="automatic-generation-of-model-binding-methods"></a>Автоматическое создание методы привязки модели

При работе с этой серии руководств, можно просто скопировать код из учебника в проект. Однако Недостаток такого подхода является, вам может не по нескольким признакам функции, предоставляемые Visual Studio для автоматического создания кода для методы привязки модели. При работе на ваших собственных проектов, автоматическое создание кода может сэкономить время и получить представление о том, как реализовать операцию. В этом разделе описывается функция создания кода. В этом разделе носит чисто информационный характер и не содержит любой код, который необходимо реализовать в своем проекте.

При установке значения для **SelectMethod**, **UpdateMethod**, **InsertMethod**, или **DeleteMethod** свойства в коде разметки можно выбрать **создайте новый метод** параметр.

![Создайте новый метод](retrieving-data/_static/image18.png)

Visual Studio не только создает метод в коде программной части с правильной сигнатурой, но также создает код реализации для упрощения выполнения операции. Если сначала установить **ItemType** свойство перед использованием функции создания кода, созданный код будет использовать этот тип для операций. Например при задании свойства UpdateMethod, автоматически создается следующий код:

[!code-csharp[Main](retrieving-data/samples/sample9.cs)]

Опять же приведенный выше код не должны быть добавлены в проект. В следующем учебном курсе необходимо реализовать методы для обновления, удаления и добавления новых данных.

## <a name="conclusion"></a>Заключение

В этом руководстве вы создана классы модели данных и создать базу данных из этих классов. Заполнение таблиц базы данных тестовыми данными. Используемые привязки модели для получения данных из базы данных и затем отображаются данные в элементе управления GridView.

В следующем [руководстве](updating-deleting-and-creating-data.md) в этой серии, вы включите обновление, удаление и создание данных.

> [!div class="step-by-step"]
> [Вперед](updating-deleting-and-creating-data.md)
