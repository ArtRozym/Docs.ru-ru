---
uid: mvc/overview/getting-started/database-first-development/enhancing-data-validation
title: 'EF Database First с ASP.NET MVC: улучшение проверки данных | Документация Майкрософт'
author: Rick-Anderson
description: С помощью MVC, Entity Framework и формирование шаблонов ASP.NET, можно создать веб-приложение, которое предоставляет интерфейс для существующей базы данных. Этот учебник seri...
ms.author: riande
ms.date: 12/29/2014
ms.assetid: 0ed5e67a-34c0-4b57-84a6-802b0fb3cd00
msc.legacyurl: /mvc/overview/getting-started/database-first-development/enhancing-data-validation
msc.type: authoredcontent
ms.openlocfilehash: df2cd99619f097c9f392e8fe7352c1ce3a69c8df
ms.sourcegitcommit: 2d3e5422d530203efdaf2014d1d7df31f88d08d0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/05/2018
ms.locfileid: "51021668"
---
<a name="ef-database-first-with-aspnet-mvc-enhancing-data-validation"></a>EF Database First с ASP.NET MVC: улучшение проверки данных
====================
по [Tom FitzMacken](https://github.com/tfitzmac)

> С помощью MVC, Entity Framework и формирование шаблонов ASP.NET, можно создать веб-приложение, которое предоставляет интерфейс для существующей базы данных. В этой серии руководств показано, как автоматически создавать код, позволяющий пользователям для отображения, изменения и создавать и удалять данные, находящиеся в таблице базы данных. Созданный код соответствует столбцам в таблице базы данных.
> 
> Части этой серии рассматривается добавление заметок к данным в модель данных, чтобы указать требования к проверке и формат отображения. Она была улучшена зависимости на отзывы от пользователей в разделе "Примечания".


## <a name="add-data-annotations"></a>Добавление заметок к данным

Как видно в предыдущей статье, некоторые правила проверки данных автоматически применяются к вводимых пользователем данных. Например число может предоставить только для свойства корпоративного уровня. Чтобы указать дополнительные правила проверки данных, можно добавить заметки к данным в классе модели. Эти заметки применяются в рамках всего веб-приложения для указанного свойства. Можно также применить атрибуты форматирования, которые изменяют способ отображения свойств; например изменив значение, используемое для подписи.

В этом руководстве вы добавите заметок к данным для ограничения длины значения, заданные для свойств FirstName, MiddleName и LastName. В базе данных эти значения являются более 50 символов; Тем не менее в веб-приложении этого предельного количества символов в настоящее время не применяется. Если пользователь предоставляет более 50 символов для одного из этих значений, странице произойдет сбой при попытке сохранить значение в базе данных. Также вы ограничите корпоративного уровня для значения в диапазоне от 0 до 4.

Откройте **Student.cs** файл **моделей** папки. Добавьте выделенный ниже код к классу.

[!code-csharp[Main](enhancing-data-validation/samples/sample1.cs?highlight=5,15,17,20)]

В Enrollment.cs добавьте следующий выделенный код.

[!code-csharp[Main](enhancing-data-validation/samples/sample2.cs?highlight=5,10)]

Постройте решение.

Перейдите на страницу редактирования или создания учащегося. Если попытаться ввести более 50 символов, отображается сообщение об ошибке.

![Отображение сообщения об ошибке](enhancing-data-validation/_static/image1.png)

Перейдите на страницу для редактирования регистраций и пытается предоставить оценку выше 4.

![Ошибка диапазона корпоративного уровня](enhancing-data-validation/_static/image2.png)

Полный список проверки заметок к данным можно применить к свойства и классы, см. в разделе [System.ComponentModel.DataAnnotations](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.aspx).

## <a name="add-metadata-classes"></a>Добавить классы метаданных

Добавление атрибутов проверки непосредственно к классу модели работает, если вы не ожидаете, что базы данных для изменения; Тем не менее если изменения базы данных и вам нужно повторно создать класс модели, вы потеряете все атрибуты, которые были применены к классу модели. Этот подход может оказаться очень неэффективным и подвержен потери важных условий.

Чтобы избежать этой проблемы, можно добавить класс метаданных, содержащий атрибуты. При связывании класса модели к классу метаданных, эти атрибуты применяются к модели. В этом случае можно повторно создать класс модели без потери всех атрибутов, примененных к классу метаданных.

В **моделей** папки, добавьте класс с именем **Metadata.cs**.

![Добавление класса метаданных](enhancing-data-validation/_static/image3.png)

Замените код в Metadata.cs следующим кодом.

[!code-csharp[Main](enhancing-data-validation/samples/sample3.cs)]

Эти классы метаданных содержат все атрибуты проверки, которые ранее были применены к классам модели. **Отображения** атрибута можно изменить значение, используемое для подписи.

Теперь классы моделей необходимо связать с классов метаданных.

В **моделей** папки, добавьте класс с именем **PartialClasses.cs**.

Замените содержимое файла следующим кодом.

[!code-csharp[Main](enhancing-data-validation/samples/sample4.cs)]

Обратите внимание, что каждый класс обозначен как `partial` класс и все совпадает с именем и пространством имен как класс, который создается автоматически. Применение атрибута метаданных в разделяемый класс, убедитесь, что атрибуты проверки данных будет применяться к классу автоматически создается. Эти атрибуты не будут потеряны при повторном создании классов модели, так как атрибут метаданных применяется в разделяемых классах, которые не восстанавливаются.

Для повторного создания автоматически генерируемых классов, откройте файл ContosoModel.edmx. Еще раз щелкните правой кнопкой мыши на область конструктора и выберите **обновить модель из базы данных**. Несмотря на то, что вы не изменили базы данных, этот процесс приведет к повторному созданию классов. В **обновить** выберите **таблиц** и **Готово**.

![обновить таблицы](enhancing-data-validation/_static/image4.png)

Сохраните файл ContosoModel.edmx, чтобы применить изменения.

Откройте файл Student.cs или Enrollment.cs и обратите внимание на то, что атрибуты проверки данных, которые были применены ранее, больше не находятся в файле. Тем не менее запустите приложение и обратите внимание на то, что по-прежнему применяются правила проверки при вводе данных.

> [!div class="step-by-step"]
> [Назад](customizing-a-view.md)
> [Вперед](publish-to-azure.md)
