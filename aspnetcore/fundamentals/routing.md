---
title: Маршрутизация в ASP.NET Core
author: ardalis
description: Узнайте, как функции маршрутизации ASP.NET Core обеспечивают сопоставление входящего запроса с обработчиком маршрутов.
ms.author: riande
ms.custom: mvc
ms.date: 10/01/2018
uid: fundamentals/routing
ms.openlocfilehash: a014782ba503bc8bd0fdefb4cb4f382aa8fde4cd
ms.sourcegitcommit: c43a6f1fe72d7c2db4b5815fd532f2b45d964e07
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/30/2018
ms.locfileid: "50244974"
---
# <a name="routing-in-aspnet-core"></a><span data-ttu-id="c1c69-103">Маршрутизация в ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="c1c69-103">Routing in ASP.NET Core</span></span>

<span data-ttu-id="c1c69-104">Авторы: [Райан Новак](https://github.com/rynowak) (Ryan Nowak), [Стив Смит](https://ardalis.com/) (Steve Smith) и [Рик Андерсон](https://twitter.com/RickAndMSFT) (Rick Anderson)</span><span class="sxs-lookup"><span data-stu-id="c1c69-104">By [Ryan Nowak](https://github.com/rynowak), [Steve Smith](https://ardalis.com/), and [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

<span data-ttu-id="c1c69-105">Функция маршрутизации обеспечивает сопоставление входящего запроса с обработчиком маршрутов.</span><span class="sxs-lookup"><span data-stu-id="c1c69-105">Routing functionality is responsible for mapping an incoming request to a route handler.</span></span> <span data-ttu-id="c1c69-106">Маршруты определяются в приложении и настраиваются при его запуске.</span><span class="sxs-lookup"><span data-stu-id="c1c69-106">Routes are defined in the app and configured when the app starts.</span></span> <span data-ttu-id="c1c69-107">Маршрут может также извлекать значения из содержащегося в запросе URL-адреса, которые затем используются для обработки запроса.</span><span class="sxs-lookup"><span data-stu-id="c1c69-107">A route can optionally extract values from the URL contained in the request, and these values can then be used for request processing.</span></span> <span data-ttu-id="c1c69-108">С помощью сведений о маршрутах из приложения функция маршрутизации также может формировать URL-адреса, сопоставленные с обработчиками маршрутов.</span><span class="sxs-lookup"><span data-stu-id="c1c69-108">Using route information from the app, the routing functionality is also able to generate URLs that map to route handlers.</span></span> <span data-ttu-id="c1c69-109">Таким образом, маршрутизация позволяет находить обработчик маршрутов по URL-адресу или URL-адрес, соответствующий определенному обработчику маршрутов, на основе сведений об обработчике.</span><span class="sxs-lookup"><span data-stu-id="c1c69-109">Therefore, routing can find a route handler based on a URL, or find the URL corresponding to a given route handler based on route handler information.</span></span>

<span data-ttu-id="c1c69-110">Для большинства приложений следует выбрать базовую описательную схему маршрутизации таким образом, чтобы URL-адреса были удобочитаемыми и осмысленными.</span><span class="sxs-lookup"><span data-stu-id="c1c69-110">Most apps should choose a basic and descriptive routing scheme so that URLs are readable and meaningful.</span></span> <span data-ttu-id="c1c69-111">Традиционный маршрут по умолчанию `{controller=Home}/{action=Index}/{id?}`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-111">The default conventional route `{controller=Home}/{action=Index}/{id?}`:</span></span>

* <span data-ttu-id="c1c69-112">Поддерживает основную и описательную схемы маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="c1c69-112">Supports a basic and descriptive routing scheme:</span></span>
* <span data-ttu-id="c1c69-113">Является хорошей начальной точкой для браузерных веб-приложений.</span><span class="sxs-lookup"><span data-stu-id="c1c69-113">Is a good starting point for web apps intended for use by browsers.</span></span>

<span data-ttu-id="c1c69-114">Как правило, в зонах приложения с высоким трафиком и в особых случаях (например, блог, электронная коммерция) добавляются дополнительные краткие маршруты с использованием [маршрутизации с помощью атрибутов](xref:mvc/controllers/routing#attribute-routing) или выделенные традиционные маршруты.</span><span class="sxs-lookup"><span data-stu-id="c1c69-114">It's common to add additional terse routes to high traffic areas of the app in specialized situations (for example, blog, ecommerce) using [attribute routing](xref:mvc/controllers/routing#attribute-routing) or dedicated conventional routes.</span></span>

<span data-ttu-id="c1c69-115">Веб-интерфейсы API должны использовать маршрутизацию с помощью атрибутов, чтобы моделировать функциональность приложения в качестве набора ресурсов, где операции представлены с помощью команд HTTP.</span><span class="sxs-lookup"><span data-stu-id="c1c69-115">Web APIs should use attribute routing to model the app's functionality as a set of resources where operations are represented by HTTP verbs.</span></span> <span data-ttu-id="c1c69-116">Это означает, что многие операции (например, GET, POST) на одном логическом ресурсе будут использовать одинаковый URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="c1c69-116">This means that many operations (for example, GET, POST) on the same logical resource will use the same URL.</span></span> <span data-ttu-id="c1c69-117">Маршрутизация с помощью атрибутов обеспечивает необходимый уровень контроля, позволяющий тщательно разработать пространство URL-адресов API-интерфейса.</span><span class="sxs-lookup"><span data-stu-id="c1c69-117">Attribute routing provides a level of control that is needed to carefully design an API's URL-space.</span></span>

<span data-ttu-id="c1c69-118">Благодаря поддержке создания URL-адресов в рамках MVC приложение можно разрабатывать без жесткого программирования URL-адресов для связывания компонентов приложения.</span><span class="sxs-lookup"><span data-stu-id="c1c69-118">MVC's URL generation support allows the app to be developed without hard coding the URLs to link the app together.</span></span> <span data-ttu-id="c1c69-119">Это обеспечивает начало работы с основной конфигурацией маршрутизации и изменение маршрутов после определения формы приложения.</span><span class="sxs-lookup"><span data-stu-id="c1c69-119">This allows for starting with a basic routing configuration, and modifying the routes after the app's shape is determined.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c1c69-120">В этом документе рассматривается низкоуровневая маршрутизация ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="c1c69-120">This document covers low-level ASP.NET Core routing.</span></span> <span data-ttu-id="c1c69-121">Сведения о маршрутизации ASP.NET Core MVC см. в разделе <xref:mvc/controllers/routing>.</span><span class="sxs-lookup"><span data-stu-id="c1c69-121">For information on ASP.NET Core MVC routing, see <xref:mvc/controllers/routing>.</span></span>

<span data-ttu-id="c1c69-122">[Просмотреть или скачать образец кода](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/routing/samples) ([как скачивать](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="c1c69-122">[View or download sample code](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/routing/samples) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="routing-basics"></a><span data-ttu-id="c1c69-123">Основы маршрутизации</span><span class="sxs-lookup"><span data-stu-id="c1c69-123">Routing basics</span></span>

<span data-ttu-id="c1c69-124">Маршрутизация использует *маршруты* (реализации интерфейса <xref:Microsoft.AspNetCore.Routing.IRouter>) в следующих целях:</span><span class="sxs-lookup"><span data-stu-id="c1c69-124">Routing uses *routes* (implementations of <xref:Microsoft.AspNetCore.Routing.IRouter>) to:</span></span>

* <span data-ttu-id="c1c69-125">для сопоставления входящих запросов с *обработчиками маршрутов*;</span><span class="sxs-lookup"><span data-stu-id="c1c69-125">Map incoming requests to *route handlers*.</span></span>
* <span data-ttu-id="c1c69-126">для создания URL-адресов, используемых в ответах.</span><span class="sxs-lookup"><span data-stu-id="c1c69-126">Generate URLs used in responses.</span></span>

<span data-ttu-id="c1c69-127">Как правило, приложение имеет одну коллекцию маршрутов.</span><span class="sxs-lookup"><span data-stu-id="c1c69-127">Generally, an app has a single collection of routes.</span></span> <span data-ttu-id="c1c69-128">При поступлении запроса коллекция маршрутов обрабатывается по порядку.</span><span class="sxs-lookup"><span data-stu-id="c1c69-128">When a request arrives, the route collection is processed in order.</span></span> <span data-ttu-id="c1c69-129">Входящий запрос ищет маршрут, соответствующий URL-адресу запроса, вызывая метод <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> для каждого маршрута, имеющегося в коллекции маршрутов.</span><span class="sxs-lookup"><span data-stu-id="c1c69-129">The incoming request looks for a route that matches the request URL by calling the <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> method on each available route in the route collection.</span></span> <span data-ttu-id="c1c69-130">В свою очередь, ответ может использовать маршрутизацию для формирования URL-адресов (например, для перенаправления или ссылок) на основе сведений о маршрутах, что позволяет избежать жесткого задания URL-адресов и упрощает поддержку.</span><span class="sxs-lookup"><span data-stu-id="c1c69-130">By contrast, a response can use routing to generate URLs (for example, for redirection or links) based on route information and thus avoid having to hard-code URLs, which helps maintainability.</span></span>

<span data-ttu-id="c1c69-131">Функция маршрутизации подключается к конвейеру [ПО промежуточного слоя](xref:fundamentals/middleware/index) с помощью класса <xref:Microsoft.AspNetCore.Builder.RouterMiddleware>.</span><span class="sxs-lookup"><span data-stu-id="c1c69-131">Routing is connected to the [middleware](xref:fundamentals/middleware/index) pipeline by the <xref:Microsoft.AspNetCore.Builder.RouterMiddleware> class.</span></span> <span data-ttu-id="c1c69-132">[ASP.NET Core MVC](xref:mvc/overview) добавляет функцию маршрутизации в конвейер ПО промежуточного слоя в процессе настройки.</span><span class="sxs-lookup"><span data-stu-id="c1c69-132">[ASP.NET Core MVC](xref:mvc/overview) adds routing to the middleware pipeline as part of its configuration.</span></span> <span data-ttu-id="c1c69-133">Сведения об использовании маршрутизации в виде отдельного компонента см. в руководстве по [использованию ПО промежуточного слоя маршрутизации](#use-routing-middleware).</span><span class="sxs-lookup"><span data-stu-id="c1c69-133">To learn about using routing as a standalone component, see [Use Routing Middleware](#use-routing-middleware) section.</span></span>

### <a name="url-matching"></a><span data-ttu-id="c1c69-134">Соответствие URL-адресов</span><span class="sxs-lookup"><span data-stu-id="c1c69-134">URL matching</span></span>

<span data-ttu-id="c1c69-135">Соответствие URL-адресов — это процесс, с помощью которого функция маршрутизации отправляет входящий запрос в *обработчик*.</span><span class="sxs-lookup"><span data-stu-id="c1c69-135">URL matching is the process by which routing dispatches an incoming request to a *handler*.</span></span> <span data-ttu-id="c1c69-136">Этот процесс основывается на данных в пути URL-адреса, но может быть расширен для учета любых данных в запросе.</span><span class="sxs-lookup"><span data-stu-id="c1c69-136">This process is based on data in the URL path but can be extended to consider any data in the request.</span></span> <span data-ttu-id="c1c69-137">Возможность отправки запросов в отдельные обработчики имеет первостепенное значение для масштабирования размера и сложности приложения.</span><span class="sxs-lookup"><span data-stu-id="c1c69-137">The ability to dispatch requests to separate handlers is key to scaling the size and complexity of an app.</span></span>

<span data-ttu-id="c1c69-138">Входящие запросы поступают в объект `RouterMiddleware`, который вызывает метод <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> для каждого маршрута по порядку.</span><span class="sxs-lookup"><span data-stu-id="c1c69-138">Incoming requests enter the `RouterMiddleware`, which calls the <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> method on each route in sequence.</span></span> <span data-ttu-id="c1c69-139">Экземпляр <xref:Microsoft.AspNetCore.Routing.IRouter> решает, следует ли *обрабатывать* запрос, присваивая свойству [RouteContext.Handler](xref:Microsoft.AspNetCore.Routing.RouteContext.Handler*) значение <xref:Microsoft.AspNetCore.Http.RequestDelegate>, отличное от NULL.</span><span class="sxs-lookup"><span data-stu-id="c1c69-139">The <xref:Microsoft.AspNetCore.Routing.IRouter> instance chooses whether to *handle* the request by setting the [RouteContext.Handler](xref:Microsoft.AspNetCore.Routing.RouteContext.Handler*) to a non-null <xref:Microsoft.AspNetCore.Http.RequestDelegate>.</span></span> <span data-ttu-id="c1c69-140">Если маршрут задает обработчик для запроса, обработка маршрутов останавливается и обработчик вызывается для обработки запроса.</span><span class="sxs-lookup"><span data-stu-id="c1c69-140">If a route sets a handler for the request, route processing stops, and the handler is invoked to process the request.</span></span> <span data-ttu-id="c1c69-141">Если были проверены все маршруты, но обработчик для запроса не найден, ПО промежуточного слоя вызывает *next*, и вызывается следующее ПО промежуточного слоя в конвейере запросов.</span><span class="sxs-lookup"><span data-stu-id="c1c69-141">If all routes are tried and no handler is found for the request, the middleware calls *next*, and the next middleware in the request pipeline is invoked.</span></span>

<span data-ttu-id="c1c69-142">Основные входные данные метода `RouteAsync` — это объект [RouteContext.HttpContext](xref:Microsoft.AspNetCore.Routing.RouteContext.HttpContext*), связанный с текущим запросом.</span><span class="sxs-lookup"><span data-stu-id="c1c69-142">The primary input to `RouteAsync` is the [RouteContext.HttpContext](xref:Microsoft.AspNetCore.Routing.RouteContext.HttpContext*) associated with the current request.</span></span> <span data-ttu-id="c1c69-143">`RouteContext.Handler` и [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData*) являются выходными значениями, заданными после нахождения соответствующего маршрута.</span><span class="sxs-lookup"><span data-stu-id="c1c69-143">The `RouteContext.Handler` and [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData*) are outputs set after a route matches.</span></span>

<span data-ttu-id="c1c69-144">При нахождении соответствия во время выполнения метода `RouteAsync` свойствам объекта `RouteContext.RouteData` также присваиваются значения с учетом уже выполненной на данный момент обработки.</span><span class="sxs-lookup"><span data-stu-id="c1c69-144">A match during `RouteAsync` also sets the properties of the `RouteContext.RouteData` to appropriate values based on the request processing performed thus far.</span></span> <span data-ttu-id="c1c69-145">Если маршрут соответствует запросу, объект `RouteContext.RouteData` содержит важные сведения о *результате*.</span><span class="sxs-lookup"><span data-stu-id="c1c69-145">If a route matches a request, the `RouteContext.RouteData` contains important state information about the *result*.</span></span>

<span data-ttu-id="c1c69-146">[RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values*) — это словарь *значений маршрута*, полученных из маршрута.</span><span class="sxs-lookup"><span data-stu-id="c1c69-146">[RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values*) is a dictionary of *route values* produced from the route.</span></span> <span data-ttu-id="c1c69-147">Как правило, эти значения определяются путем разбивки URL-адреса на сегменты и могут использоваться для принятия входных данных пользователя или принятия дальнейших решений об отправке в приложении.</span><span class="sxs-lookup"><span data-stu-id="c1c69-147">These values are usually determined by tokenizing the URL and can be used to accept user input or to make further dispatching decisions inside the app.</span></span>

<span data-ttu-id="c1c69-148">[RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) — это контейнер свойств с дополнительными данными, связанными с соответствующим маршрутом.</span><span class="sxs-lookup"><span data-stu-id="c1c69-148">[RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) is a property bag of additional data related to the matched route.</span></span> <span data-ttu-id="c1c69-149">Свойства `DataTokens` обеспечивают связывание данных состояния с каждым маршрутом, что позволяет приложению в дальнейшем принимать решения в зависимости от соответствующего маршрута.</span><span class="sxs-lookup"><span data-stu-id="c1c69-149">`DataTokens` are provided to support associating state data with each route so that the app can make decisions later based on which route matched.</span></span> <span data-ttu-id="c1c69-150">Эти значения определяются разработчиком и никоим образом **не** влияют на поведение маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="c1c69-150">These values are developer-defined and do **not** affect the behavior of routing in any way.</span></span> <span data-ttu-id="c1c69-151">Кроме того, значения, спрятанные в `RouteData.DataTokens`, могут быть любого типа в отличие от `RouteData.Values`, которые должны легко преобразовываться в строки и из строк.</span><span class="sxs-lookup"><span data-stu-id="c1c69-151">Additionally, values stashed in `RouteData.DataTokens` can be of any type, in contrast to `RouteData.Values`, which must be easily convertible to and from strings.</span></span>

<span data-ttu-id="c1c69-152">[RouteData.Routers](xref:Microsoft.AspNetCore.Routing.RouteData.Routers*) — это список маршрутов, которые участвовали в успешном сопоставлении с запросом.</span><span class="sxs-lookup"><span data-stu-id="c1c69-152">[RouteData.Routers](xref:Microsoft.AspNetCore.Routing.RouteData.Routers*) is a list of the routes that took part in successfully matching the request.</span></span> <span data-ttu-id="c1c69-153">Маршруты могут быть вложены друг в друга.</span><span class="sxs-lookup"><span data-stu-id="c1c69-153">Routes can be nested inside of one another.</span></span> <span data-ttu-id="c1c69-154">Свойство `Routers` отражает путь по логическому дереву маршрутов, который привел к совпадению.</span><span class="sxs-lookup"><span data-stu-id="c1c69-154">The `Routers` property reflects the path through the logical tree of routes that resulted in a match.</span></span> <span data-ttu-id="c1c69-155">Как правило, первый элемент в свойстве `Routers` — это коллекция маршрутов, используемая для формирования URL-адресов.</span><span class="sxs-lookup"><span data-stu-id="c1c69-155">Generally, the first item in `Routers` is the route collection and should be used for URL generation.</span></span> <span data-ttu-id="c1c69-156">Последний элемент в свойстве `Routers` — это соответствующий обработчик маршрутов.</span><span class="sxs-lookup"><span data-stu-id="c1c69-156">The last item in `Routers` is the route handler that matched.</span></span>

### <a name="url-generation"></a><span data-ttu-id="c1c69-157">Формирование URL-адреса</span><span class="sxs-lookup"><span data-stu-id="c1c69-157">URL generation</span></span>

<span data-ttu-id="c1c69-158">Формирование URL-адреса — это процесс создания пути URL-адреса функцией маршрутизации на основе набора значений маршрута.</span><span class="sxs-lookup"><span data-stu-id="c1c69-158">URL generation is the process by which routing can create a URL path based on a set of route values.</span></span> <span data-ttu-id="c1c69-159">Он обеспечивает логическое разделение обработчиков и URL-адресов, по которым к ним осуществляется доступ.</span><span class="sxs-lookup"><span data-stu-id="c1c69-159">This allows for a logical separation between your handlers and the URLs that access them.</span></span>

<span data-ttu-id="c1c69-160">Формирование URL-адреса — это итеративный процесс, который начинается с того, что пользовательский код или код платформы вызывает метод <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> коллекции маршрутов.</span><span class="sxs-lookup"><span data-stu-id="c1c69-160">URL generation follows a similar iterative process, but it starts with user or framework code calling into the <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> method of the route collection.</span></span> <span data-ttu-id="c1c69-161">Затем по очереди вызывается метод `GetVirtualPath` каждого *маршрута*, пока не будет возвращен объект <xref:Microsoft.AspNetCore.Routing.VirtualPathData>, отличный от NULL.</span><span class="sxs-lookup"><span data-stu-id="c1c69-161">Each *route* then has its `GetVirtualPath` method called in sequence until a non-null <xref:Microsoft.AspNetCore.Routing.VirtualPathData> is returned.</span></span>

<span data-ttu-id="c1c69-162">Основные входные параметры метода `GetVirtualPath`:</span><span class="sxs-lookup"><span data-stu-id="c1c69-162">The primary inputs to `GetVirtualPath` are:</span></span>

* [<span data-ttu-id="c1c69-163">VirtualPathContext.HttpContext</span><span class="sxs-lookup"><span data-stu-id="c1c69-163">VirtualPathContext.HttpContext</span></span>](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.HttpContext*)
* [<span data-ttu-id="c1c69-164">VirtualPathContext.Values</span><span class="sxs-lookup"><span data-stu-id="c1c69-164">VirtualPathContext.Values</span></span>](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values*)
* [<span data-ttu-id="c1c69-165">VirtualPathContext.AmbientValues</span><span class="sxs-lookup"><span data-stu-id="c1c69-165">VirtualPathContext.AmbientValues</span></span>](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues*)

<span data-ttu-id="c1c69-166">Для определения возможности создания URL-адреса и включаемых значений в первую очередь используются значения, передаваемые в свойствах `Values` и `AmbientValues`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-166">Routes primarily use the route values provided by the `Values` and `AmbientValues` to decide whether it's possible to generate a URL and what values to include.</span></span> <span data-ttu-id="c1c69-167">`AmbientValues` — это набор значений маршрута, полученных в результате сопоставления текущего запроса с системой маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="c1c69-167">The `AmbientValues` are the set of route values that were produced from matching the current request with the routing system.</span></span> <span data-ttu-id="c1c69-168">В свою очередь, `Values` — это значения, определяющие способ создания нужного URL-адреса для текущей операции.</span><span class="sxs-lookup"><span data-stu-id="c1c69-168">In contrast, `Values` are the route values that specify how to generate the desired URL for the current operation.</span></span> <span data-ttu-id="c1c69-169">`HttpContext` предоставляется в том случае, если маршруту необходимо получить службы или дополнительные данные, связанные с текущим контекстом.</span><span class="sxs-lookup"><span data-stu-id="c1c69-169">The `HttpContext` is provided in case a route needs to obtain services or additional data associated with the current context.</span></span>

> [!TIP]
> <span data-ttu-id="c1c69-170">Можно рассматривать [VirtualPathContext.Values](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values*) как набор переопределений для [VirtualPathContext.AmbientValues](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues*).</span><span class="sxs-lookup"><span data-stu-id="c1c69-170">Think of [VirtualPathContext.Values](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values*) as being a set of overrides for the [VirtualPathContext.AmbientValues](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues*).</span></span> <span data-ttu-id="c1c69-171">При формировании URL-адреса производится попытка повторного использования значений маршрута из текущего запроса, что упрощает создание URL-адресов для ссылок с помощью того же маршрута или значений маршрута.</span><span class="sxs-lookup"><span data-stu-id="c1c69-171">URL generation attempts to reuse route values from the current request to make it easy to generate URLs for links using the same route or route values.</span></span>

<span data-ttu-id="c1c69-172">Выходные данные метода `GetVirtualPath` содержатся в объекте `VirtualPathData`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-172">The output of `GetVirtualPath` is a `VirtualPathData`.</span></span> <span data-ttu-id="c1c69-173">Объект `VirtualPathData` аналогичен `RouteData`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-173">`VirtualPathData` is a parallel of `RouteData`.</span></span> <span data-ttu-id="c1c69-174">`VirtualPathData` содержит `VirtualPath` для выходного URL-адреса, а также ряд дополнительных свойств, которые должны быть заданы маршрутом.</span><span class="sxs-lookup"><span data-stu-id="c1c69-174">`VirtualPathData` contains the `VirtualPath` for the output URL and some additional properties that should be set by the route.</span></span>

<span data-ttu-id="c1c69-175">Свойство [VirtualPathData.VirtualPath](xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath*) содержит *виртуальный путь*, создаваемый маршрутом.</span><span class="sxs-lookup"><span data-stu-id="c1c69-175">The [VirtualPathData.VirtualPath](xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath*) property contains the *virtual path* produced by the route.</span></span> <span data-ttu-id="c1c69-176">В зависимости от ситуации путь может требовать дальнейшей обработки.</span><span class="sxs-lookup"><span data-stu-id="c1c69-176">Depending on your needs, you may need to process the path further.</span></span> <span data-ttu-id="c1c69-177">Чтобы представить созданный URL-адрес в формате HTML, добавьте в его начало базовый путь приложения.</span><span class="sxs-lookup"><span data-stu-id="c1c69-177">If you want to render the generated URL in HTML, prepend the base path of the app.</span></span>

<span data-ttu-id="c1c69-178">[VirtualPathData.Router](xref:Microsoft.AspNetCore.Routing.VirtualPathData.Router*) — это ссылка на маршрут, который успешно создал URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="c1c69-178">The [VirtualPathData.Router](xref:Microsoft.AspNetCore.Routing.VirtualPathData.Router*) is a reference to the route that successfully generated the URL.</span></span>

<span data-ttu-id="c1c69-179">Свойства [VirtualPathData.DataTokens](xref:Microsoft.AspNetCore.Routing.VirtualPathData.DataTokens*) представляют собой словарь дополнительных данных, связанных с маршрутом, который создал URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="c1c69-179">The [VirtualPathData.DataTokens](xref:Microsoft.AspNetCore.Routing.VirtualPathData.DataTokens*) properties is a dictionary of additional data related to the route that generated the URL.</span></span> <span data-ttu-id="c1c69-180">Это эквивалент объекта [RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*).</span><span class="sxs-lookup"><span data-stu-id="c1c69-180">This is the parallel of [RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*).</span></span>

### <a name="creating-routes"></a><span data-ttu-id="c1c69-181">Создание маршрутов</span><span class="sxs-lookup"><span data-stu-id="c1c69-181">Creating routes</span></span>

<span data-ttu-id="c1c69-182">Маршрутизация предоставляет класс <xref:Microsoft.AspNetCore.Routing.Route> в качестве стандартной реализации <xref:Microsoft.AspNetCore.Routing.IRouter>.</span><span class="sxs-lookup"><span data-stu-id="c1c69-182">Routing provides the <xref:Microsoft.AspNetCore.Routing.Route> class as the standard implementation of <xref:Microsoft.AspNetCore.Routing.IRouter>.</span></span> <span data-ttu-id="c1c69-183">Класс `Route` использует синтаксис *шаблона маршрута* для определения шаблонов, которые будут сопоставляться с путем URL-адреса при вызове метода <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*>.</span><span class="sxs-lookup"><span data-stu-id="c1c69-183">`Route` uses the *route template* syntax to define patterns that match against the URL path when <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> is called.</span></span> <span data-ttu-id="c1c69-184">При вызове метода `GetVirtualPath` объект `Route` будет использовать тот же шаблон маршрута для создания URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="c1c69-184">`Route` uses the same route template to generate a URL when `GetVirtualPath` is called.</span></span>

<span data-ttu-id="c1c69-185">Большинство приложений создают маршруты, вызывая метод <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> или один из аналогичных методов расширения, определенных в интерфейсе <xref:Microsoft.AspNetCore.Routing.IRouteBuilder>.</span><span class="sxs-lookup"><span data-stu-id="c1c69-185">Most apps create routes by calling <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> or one of the similar extension methods defined on <xref:Microsoft.AspNetCore.Routing.IRouteBuilder>.</span></span> <span data-ttu-id="c1c69-186">Все эти методы создают экземпляр класса <xref:Microsoft.AspNetCore.Routing.Route> и добавляют его в коллекцию маршрутов.</span><span class="sxs-lookup"><span data-stu-id="c1c69-186">All of these methods create an instance of <xref:Microsoft.AspNetCore.Routing.Route> and add it to the route collection.</span></span>

<span data-ttu-id="c1c69-187">`MapRoute` не принимает параметр обработчика маршрутов.</span><span class="sxs-lookup"><span data-stu-id="c1c69-187">`MapRoute` doesn't take a route handler parameter.</span></span> <span data-ttu-id="c1c69-188">`MapRoute` только добавляет маршруты, которые обрабатываются <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span><span class="sxs-lookup"><span data-stu-id="c1c69-188">`MapRoute` only adds routes that are handled by the <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span></span> <span data-ttu-id="c1c69-189">Так как обработчик по умолчанию — это интерфейс `IRouter`, он может решить не обрабатывать запрос.</span><span class="sxs-lookup"><span data-stu-id="c1c69-189">Since the default handler is an `IRouter`, it may decide not to handle the request.</span></span> <span data-ttu-id="c1c69-190">Например, ASP.NET Core MVC обычно настраивается в качестве обработчика по умолчанию, который обрабатывает только те запросы, которые соответствуют доступным контроллеру и действию.</span><span class="sxs-lookup"><span data-stu-id="c1c69-190">For example, ASP.NET Core MVC is typically configured as a default handler that only handles requests that match an available controller and action.</span></span> <span data-ttu-id="c1c69-191">Дополнительные сведения о маршрутизации в MVC см. в разделе <xref:mvc/controllers/routing>.</span><span class="sxs-lookup"><span data-stu-id="c1c69-191">To learn more about routing to MVC, see <xref:mvc/controllers/routing>.</span></span>

<span data-ttu-id="c1c69-192">В следующем коде приводится пример вызова `MapRoute`, используемого в типичном определении маршрута ASP.NET Core MVC:</span><span class="sxs-lookup"><span data-stu-id="c1c69-192">The following code example is an example of a `MapRoute` call used by a typical ASP.NET Core MVC route definition:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="c1c69-193">Этот шаблон соответствует такому пути URL-адреса, как `/Products/Details/17`, и извлекает значения маршрута `{ controller = Products, action = Details, id = 17 }`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-193">This template matches a URL path like `/Products/Details/17` and extracts the route values `{ controller = Products, action = Details, id = 17 }`.</span></span> <span data-ttu-id="c1c69-194">Значения маршрута определяются с помощью разделения пути URL-адреса на сегменты и сопоставления каждого сегмента с именем *параметра маршрута* в шаблоне маршрута.</span><span class="sxs-lookup"><span data-stu-id="c1c69-194">The route values are determined by splitting the URL path into segments and matching each segment with the *route parameter* name in the route template.</span></span> <span data-ttu-id="c1c69-195">Параметры маршрута являются именованными.</span><span class="sxs-lookup"><span data-stu-id="c1c69-195">Route parameters are named.</span></span> <span data-ttu-id="c1c69-196">Они определяются путем заключения имени параметра в фигурные скобки `{ ... }`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-196">They're defined by enclosing the parameter name in braces `{ ... }`.</span></span>

<span data-ttu-id="c1c69-197">Приведенный выше шаблон может также соответствовать пути URL-адреса `/`. В этом случае он предоставляет значения `{ controller = Home, action = Index }`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-197">The preceding template could also match the URL path `/` and would produce the values `{ controller = Home, action = Index }`.</span></span> <span data-ttu-id="c1c69-198">Связано это с тем, что параметры маршрута `{controller}` и `{action}` имеют значения по умолчанию, а параметр маршрута `id` является необязательным.</span><span class="sxs-lookup"><span data-stu-id="c1c69-198">This occurs because the `{controller}` and `{action}` route parameters have default values and the `id` route parameter is optional.</span></span> <span data-ttu-id="c1c69-199">Значение по умолчанию для параметра маршрута определяется с помощью знака равенства `=`, за которым следует значение, после имени параметра.</span><span class="sxs-lookup"><span data-stu-id="c1c69-199">An equals `=` sign followed by a value after the route parameter name defines a default value for the parameter.</span></span> <span data-ttu-id="c1c69-200">Вопросительный знак `?` после имени параметра маршрута определяет параметр как необязательный.</span><span class="sxs-lookup"><span data-stu-id="c1c69-200">A question mark `?` after the route parameter name defines the parameter as optional.</span></span> <span data-ttu-id="c1c69-201">Параметры маршрута со значением по умолчанию *всегда* предоставляют значения маршрута при совпадении маршрута.</span><span class="sxs-lookup"><span data-stu-id="c1c69-201">Route parameters with a default value *always* produce a route value when the route matches.</span></span> <span data-ttu-id="c1c69-202">Необязательные параметры не предоставляют значение маршрута, если нет соответствующего сегмента пути URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="c1c69-202">Optional parameters don't produce a route value if there was no corresponding URL path segment.</span></span>

<span data-ttu-id="c1c69-203">Подробное описание функций и синтаксиса шаблона маршрута см. в разделе [Справочник по шаблону маршрута](#route-template-reference).</span><span class="sxs-lookup"><span data-stu-id="c1c69-203">See [route-template-reference](#route-template-reference) for a thorough description of route template features and syntax.</span></span>

<span data-ttu-id="c1c69-204">В этом примере применяется *ограничение маршрута*:</span><span class="sxs-lookup"><span data-stu-id="c1c69-204">This example includes a *route constraint*:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id:int}");
```

<span data-ttu-id="c1c69-205">Этот шаблон соответствует такому пути URL-адреса, как `/Products/Details/17`, но не `/Products/Details/Apples`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-205">This template matches a URL path like `/Products/Details/17` but not `/Products/Details/Apples`.</span></span> <span data-ttu-id="c1c69-206">В определении параметра маршрута `{id:int}` определяется [ограничение маршрута](#route-constraint-reference) для параметра маршрута `id`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-206">The route parameter definition `{id:int}` defines a [route constraint](#route-constraint-reference) for the `id` route parameter.</span></span> <span data-ttu-id="c1c69-207">Ограничения маршрута реализуют интерфейс <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> и проверяют значения маршрута.</span><span class="sxs-lookup"><span data-stu-id="c1c69-207">Route constraints implement <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> and inspect route values to verify them.</span></span> <span data-ttu-id="c1c69-208">В этом примере значение маршрута `id` должно иметь возможность преобразования в целое число.</span><span class="sxs-lookup"><span data-stu-id="c1c69-208">In this example, the route value `id` must be convertible to an integer.</span></span> <span data-ttu-id="c1c69-209">Более подробное описание ограничений маршрутов, предоставляемых платформой, см. в разделе [Справочник по ограничениям маршрутов](#route-constraint-reference).</span><span class="sxs-lookup"><span data-stu-id="c1c69-209">See [route-constraint-reference](#route-constraint-reference) for a more detailed explanation of route constraints that are provided by the framework.</span></span>

<span data-ttu-id="c1c69-210">Дополнительные перегрузки `MapRoute` принимают значения для параметров `constraints`, `dataTokens` и `defaults`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-210">Additional overloads of `MapRoute` accept values for `constraints`, `dataTokens`, and `defaults`.</span></span> <span data-ttu-id="c1c69-211">Эти дополнительные параметры метода `MapRoute` определены как имеющие тип `object`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-211">These additional parameters of `MapRoute` are defined as type `object`.</span></span> <span data-ttu-id="c1c69-212">Типичное применение этих параметров состоит в передаче анонимно типизированного объекта, причем имена свойств анонимного типа соответствуют именам параметров маршрута.</span><span class="sxs-lookup"><span data-stu-id="c1c69-212">The typical usage of these parameters is to pass an anonymously typed object, where the property names of the anonymous type match route parameter names.</span></span>

<span data-ttu-id="c1c69-213">В двух следующих примерах создаются эквивалентные маршруты:</span><span class="sxs-lookup"><span data-stu-id="c1c69-213">The following two examples create equivalent routes:</span></span>

```csharp
routes.MapRoute(
    name: "default_route",
    template: "{controller}/{action}/{id?}",
    defaults: new { controller = "Home", action = "Index" });

routes.MapRoute(
    name: "default_route",
    template: "{controller=Home}/{action=Index}/{id?}");
```

> [!TIP]
> <span data-ttu-id="c1c69-214">Встроенный синтаксис определения ограничений и значений по умолчанию может быть удобнее для простых маршрутов.</span><span class="sxs-lookup"><span data-stu-id="c1c69-214">The inline syntax for defining constraints and defaults can be convenient for simple routes.</span></span> <span data-ttu-id="c1c69-215">Однако некоторые возможности, например токены данных, не поддерживаются встроенным синтаксисом.</span><span class="sxs-lookup"><span data-stu-id="c1c69-215">However, there are features, such as data tokens, that aren't supported by inline syntax.</span></span>

<span data-ttu-id="c1c69-216">В следующем примере показано еще несколько сценариев:</span><span class="sxs-lookup"><span data-stu-id="c1c69-216">The following example demonstrates a few more scenarios:</span></span>

```csharp
routes.MapRoute(
    name: "blog",
    template: "Blog/{*article}",
    defaults: new { controller = "Blog", action = "ReadArticle" });
```

<span data-ttu-id="c1c69-217">Этот шаблон соответствует такому пути URL-адреса, как `/Blog/All-About-Routing/Introduction`, и извлекает значения `{ controller = Blog, action = ReadArticle, article = All-About-Routing/Introduction }`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-217">This template matches a URL path like `/Blog/All-About-Routing/Introduction` and extracts the values `{ controller = Blog, action = ReadArticle, article = All-About-Routing/Introduction }`.</span></span> <span data-ttu-id="c1c69-218">Значения маршрута по умолчанию для `controller` и `action` предоставляются маршрутом несмотря на то, что в шаблоне нет соответствующих параметров маршрута.</span><span class="sxs-lookup"><span data-stu-id="c1c69-218">The default route values for `controller` and `action` are produced by the route even though there are no corresponding route parameters in the template.</span></span> <span data-ttu-id="c1c69-219">Значения по умолчанию можно указать в шаблоне маршрута.</span><span class="sxs-lookup"><span data-stu-id="c1c69-219">Default values can be specified in the route template.</span></span> <span data-ttu-id="c1c69-220">Параметр маршрута `article` определяется как *универсальный* с помощью звездочки `*` перед его именем.</span><span class="sxs-lookup"><span data-stu-id="c1c69-220">The `article` route parameter is defined as a *catch-all* by the appearance of an asterisk `*` before the route parameter name.</span></span> <span data-ttu-id="c1c69-221">Универсальные параметры маршрута служат для фиксации оставшейся части пути URL-адреса, а также могут соответствовать пустой строке.</span><span class="sxs-lookup"><span data-stu-id="c1c69-221">Catch-all route parameters capture the remainder of the URL path and can also match the empty string.</span></span>

<span data-ttu-id="c1c69-222">В этом примере добавляются ограничения маршрута и токены данных:</span><span class="sxs-lookup"><span data-stu-id="c1c69-222">This example adds route constraints and data tokens:</span></span>

```csharp
routes.MapRoute(
    name: "us_english_products",
    template: "en-US/Products/{id}",
    defaults: new { controller = "Products", action = "Details" },
    constraints: new { id = new IntRouteConstraint() },
    dataTokens: new { locale = "en-US" });
```

<span data-ttu-id="c1c69-223">Этот шаблон будет соответствовать такому пути URL-адреса, как `/en-US/Products/5`, и будет извлекать значения `{ controller = Products, action = Details, id = 5 }` и токены данных `{ locale = en-US }`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-223">This template matches a URL path like `/en-US/Products/5` and extracts the values `{ controller = Products, action = Details, id = 5 }` and the data tokens `{ locale = en-US }`.</span></span>

![Токены в окне "Локальные"](routing/_static/tokens.png)

### <a name="url-generation"></a><span data-ttu-id="c1c69-225">Формирование URL-адреса</span><span class="sxs-lookup"><span data-stu-id="c1c69-225">URL generation</span></span>

<span data-ttu-id="c1c69-226">Класс `Route` может также формировать URL-адрес, объединяя набор значений маршрута с шаблоном маршрута.</span><span class="sxs-lookup"><span data-stu-id="c1c69-226">The `Route` class can also perform URL generation by combining a set of route values with its route template.</span></span> <span data-ttu-id="c1c69-227">С логической точки зрения, этот процесс обратен сопоставлению пути URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="c1c69-227">This is logically the reverse process of matching the URL path.</span></span>

> [!TIP]
> <span data-ttu-id="c1c69-228">Чтобы лучше понять процесс формирования URL-адреса, представьте себе, какой URL-адрес нужно создать, а затем подумайте, как шаблон маршрута будет сопоставляться с этим URL-адресом.</span><span class="sxs-lookup"><span data-stu-id="c1c69-228">To better understand URL generation, imagine what URL you want to generate and then think about how a route template would match that URL.</span></span> <span data-ttu-id="c1c69-229">Какие значения будут получены?</span><span class="sxs-lookup"><span data-stu-id="c1c69-229">What values would be produced?</span></span> <span data-ttu-id="c1c69-230">Примерно так производится формирование URL-адреса в классе `Route`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-230">This is the rough equivalent of how URL generation works in the `Route` class.</span></span>

<span data-ttu-id="c1c69-231">В этом примере используется базовый маршрут в стиле ASP.NET Core MVC:</span><span class="sxs-lookup"><span data-stu-id="c1c69-231">This example uses a basic ASP.NET Core MVC style route:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="c1c69-232">При значениях маршрута `{ controller = Products, action = List }` этот маршрут создает URL-адрес `/Products/List`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-232">With the route values `{ controller = Products, action = List }`, this route generates the URL `/Products/List`.</span></span> <span data-ttu-id="c1c69-233">Значения маршрута заменяются на соответствующие параметры маршрута для образования пути URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="c1c69-233">The route values are substituted for the corresponding route parameters to form the URL path.</span></span> <span data-ttu-id="c1c69-234">Так как `id` — это необязательный параметр маршрута, отсутствие у него значения не представляет проблемы.</span><span class="sxs-lookup"><span data-stu-id="c1c69-234">Since `id` is an optional route parameter, it's no problem that it doesn't have a value.</span></span>

<span data-ttu-id="c1c69-235">При значениях маршрута `{ controller = Home, action = Index }` этот маршрут создает URL-адрес `/`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-235">With the route values `{ controller = Home, action = Index }`, this route generates the URL `/`.</span></span> <span data-ttu-id="c1c69-236">Предоставленные значения маршрута соответствуют значениям по умолчанию, поэтому соответствующие им сегменты можно спокойно опустить.</span><span class="sxs-lookup"><span data-stu-id="c1c69-236">The route values that were provided match the default values so that the segments corresponding to those values can be safely omitted.</span></span> <span data-ttu-id="c1c69-237">Оба созданных URL-адреса будут совершать круговой путь с таким же определением маршрута и предоставлять те же значения маршрута, которые использовались для формирования URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="c1c69-237">Both URLs generated round-trip with this route definition and produce the same route values that were used to generate the URL.</span></span>

> [!TIP]
> <span data-ttu-id="c1c69-238">Приложение, использующее платформу ASP.NET Core MVC, должно создавать URL-адреса с помощью объекта <xref:Microsoft.AspNetCore.Mvc.Routing.UrlHelper>, а не вызывать маршрутизацию напрямую.</span><span class="sxs-lookup"><span data-stu-id="c1c69-238">An app using ASP.NET Core MVC should use <xref:Microsoft.AspNetCore.Mvc.Routing.UrlHelper> to generate URLs instead of calling into routing directly.</span></span>

<span data-ttu-id="c1c69-239">Дополнительные сведения о формировании URL-адресов см. в [справочнике по формированию URL-адрес](#url-generation-reference).</span><span class="sxs-lookup"><span data-stu-id="c1c69-239">For more information about URL generation, see [url-generation-reference](#url-generation-reference).</span></span>

## <a name="use-routing-middleware"></a><span data-ttu-id="c1c69-240">Использование ПО промежуточного слоя маршрутизации</span><span class="sxs-lookup"><span data-stu-id="c1c69-240">Use Routing Middleware</span></span>

::: moniker range=">= aspnetcore-2.1"

<span data-ttu-id="c1c69-241">Ссылка на [метапакет Microsoft.AspNetCore.App](xref:fundamentals/metapackage-app) в файле проекта приложения.</span><span class="sxs-lookup"><span data-stu-id="c1c69-241">Reference the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) in the app's project file.</span></span>

::: moniker-end

::: moniker range="= aspnetcore-2.0"

<span data-ttu-id="c1c69-242">Ссылка на [метапакет Microsoft.AspNetCore.All](xref:fundamentals/metapackage) в файле проекта приложения.</span><span class="sxs-lookup"><span data-stu-id="c1c69-242">Reference the [Microsoft.AspNetCore.All metapackage](xref:fundamentals/metapackage) in the app's project file.</span></span>

::: moniker-end

::: moniker range="< aspnetcore-2.0"

<span data-ttu-id="c1c69-243">Ссылка на [метапакет Microsoft.AspNetCore.Routing](https://www.nuget.org/packages/Microsoft.AspNetCore.Routing/) в файле проекта приложения.</span><span class="sxs-lookup"><span data-stu-id="c1c69-243">Reference the [Microsoft.AspNetCore.Routing](https://www.nuget.org/packages/Microsoft.AspNetCore.Routing/) in the app's project file.</span></span>

::: moniker-end

<span data-ttu-id="c1c69-244">Добавьте маршрутизацию в контейнер службы в файле `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="c1c69-244">Add routing to the service container in `Startup.ConfigureServices`:</span></span>

::: moniker range=">= aspnetcore-2.0"

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_ConfigureServices&highlight=3)]

::: moniker-end

::: moniker range="< aspnetcore-2.0"

[!code-csharp[](routing/samples/1.x/RoutingSample/Startup.cs?name=snippet_ConfigureServices&highlight=3)]

::: moniker-end

<span data-ttu-id="c1c69-245">Маршруты должны настраиваться в методе `Startup.Configure`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-245">Routes must be configured in the `Startup.Configure` method.</span></span> <span data-ttu-id="c1c69-246">В приведенном примере приложения используются следующие интерфейсы API:</span><span class="sxs-lookup"><span data-stu-id="c1c69-246">The sample app uses these APIs:</span></span>

* `RouteBuilder`
* `Build`
* <span data-ttu-id="c1c69-247">`MapGet` &ndash; — соответствует только HTTP-запросам GET.</span><span class="sxs-lookup"><span data-stu-id="c1c69-247">`MapGet` &ndash; Matches only HTTP GET requests.</span></span>
* `UseRouter`

::: moniker range=">= aspnetcore-2.0"

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_RouteHandler)]

::: moniker-end

::: moniker range="< aspnetcore-2.0"

[!code-csharp[](routing/samples/1.x/RoutingSample/Startup.cs?name=snippet_RouteHandler)]

::: moniker-end

<span data-ttu-id="c1c69-248">В таблице ниже приведены ответы с данными универсальными кодами ресурсов (URI).</span><span class="sxs-lookup"><span data-stu-id="c1c69-248">The following table shows the responses with the given URIs.</span></span>

| <span data-ttu-id="c1c69-249">URI</span><span class="sxs-lookup"><span data-stu-id="c1c69-249">URI</span></span>                  | <span data-ttu-id="c1c69-250">Ответ</span><span class="sxs-lookup"><span data-stu-id="c1c69-250">Response</span></span>                                          |
| -------------------- | ------------------------------------------------- |
| <span data-ttu-id="c1c69-251">/package/create/3</span><span class="sxs-lookup"><span data-stu-id="c1c69-251">/package/create/3</span></span>    | <span data-ttu-id="c1c69-252">Hello!</span><span class="sxs-lookup"><span data-stu-id="c1c69-252">Hello!</span></span> <span data-ttu-id="c1c69-253">Значения маршрута: [operation, create], [id, 3]</span><span class="sxs-lookup"><span data-stu-id="c1c69-253">Route values: [operation, create], [id, 3]</span></span> |
| <span data-ttu-id="c1c69-254">/package/track/-3</span><span class="sxs-lookup"><span data-stu-id="c1c69-254">/package/track/-3</span></span>    | <span data-ttu-id="c1c69-255">Hello!</span><span class="sxs-lookup"><span data-stu-id="c1c69-255">Hello!</span></span> <span data-ttu-id="c1c69-256">Значения маршрута: [operation, track], [id, -3]</span><span class="sxs-lookup"><span data-stu-id="c1c69-256">Route values: [operation, track], [id, -3]</span></span> |
| <span data-ttu-id="c1c69-257">/package/track/-3/</span><span class="sxs-lookup"><span data-stu-id="c1c69-257">/package/track/-3/</span></span>   | <span data-ttu-id="c1c69-258">Hello!</span><span class="sxs-lookup"><span data-stu-id="c1c69-258">Hello!</span></span> <span data-ttu-id="c1c69-259">Значения маршрута: [operation, track], [id, -3]</span><span class="sxs-lookup"><span data-stu-id="c1c69-259">Route values: [operation, track], [id, -3]</span></span> |
| <span data-ttu-id="c1c69-260">/package/track/</span><span class="sxs-lookup"><span data-stu-id="c1c69-260">/package/track/</span></span>      | <span data-ttu-id="c1c69-261">&lt;Неудачно, нет совпадения&gt;</span><span class="sxs-lookup"><span data-stu-id="c1c69-261">&lt;Fall through, no match&gt;</span></span>                    |
| <span data-ttu-id="c1c69-262">GET /hello/Joe</span><span class="sxs-lookup"><span data-stu-id="c1c69-262">GET /hello/Joe</span></span>       | <span data-ttu-id="c1c69-263">Hi, Joe!</span><span class="sxs-lookup"><span data-stu-id="c1c69-263">Hi, Joe!</span></span>                                          |
| <span data-ttu-id="c1c69-264">POST /hello/Joe</span><span class="sxs-lookup"><span data-stu-id="c1c69-264">POST /hello/Joe</span></span>      | <span data-ttu-id="c1c69-265">&lt;Неудачно, совпадение только с HTTP GET&gt;</span><span class="sxs-lookup"><span data-stu-id="c1c69-265">&lt;Fall through, matches HTTP GET only&gt;</span></span>       |
| <span data-ttu-id="c1c69-266">GET /hello/Joe/Smith</span><span class="sxs-lookup"><span data-stu-id="c1c69-266">GET /hello/Joe/Smith</span></span> | <span data-ttu-id="c1c69-267">&lt;Неудачно, нет совпадения&gt;</span><span class="sxs-lookup"><span data-stu-id="c1c69-267">&lt;Fall through, no match&gt;</span></span>                    |

<span data-ttu-id="c1c69-268">Если вы настраиваете один маршрут, вызовите <xref:Microsoft.AspNetCore.Builder.RoutingBuilderExtensions.UseRouter*>, передав экземпляр `IRouter`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-268">If you're configuring a single route, call <xref:Microsoft.AspNetCore.Builder.RoutingBuilderExtensions.UseRouter*> passing in an `IRouter` instance.</span></span> <span data-ttu-id="c1c69-269">Использовать <xref:Microsoft.AspNetCore.Routing.RouteBuilder> не нужно.</span><span class="sxs-lookup"><span data-stu-id="c1c69-269">You won't need to use <xref:Microsoft.AspNetCore.Routing.RouteBuilder>.</span></span>

<span data-ttu-id="c1c69-270">Платформа предоставляет наборов методов расширения для создания маршрутов, включая следующие:</span><span class="sxs-lookup"><span data-stu-id="c1c69-270">The framework provides a set of extension methods for creating routes, such as:</span></span>

* `MapRoute`
* `MapGet`
* `MapPost`
* `MapPut`
* `MapDelete`
* `MapVerb`

<span data-ttu-id="c1c69-271">Некоторые из этих методов, например `MapGet`, требуют предоставления `RequestDelegate`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-271">Some of these methods, such as `MapGet`, require a `RequestDelegate` to be provided.</span></span> <span data-ttu-id="c1c69-272">`RequestDelegate` используется в качестве *обработчика маршрутов* при совпадении маршрута.</span><span class="sxs-lookup"><span data-stu-id="c1c69-272">The `RequestDelegate` is used as the *route handler* when the route matches.</span></span> <span data-ttu-id="c1c69-273">Другие методы из этого семейства позволяют настраивать конвейер ПО промежуточного слоя, который будет использоваться в качестве обработчика маршрутов.</span><span class="sxs-lookup"><span data-stu-id="c1c69-273">Other methods in this family allow configuring a middleware pipeline for use as the route handler.</span></span> <span data-ttu-id="c1c69-274">Если метод *Map* не принимает обработчик, например `MapRoute`, он будет использовать объект <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span><span class="sxs-lookup"><span data-stu-id="c1c69-274">If the *Map* method doesn't accept a handler, such as `MapRoute`, then it uses the <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span></span>

<span data-ttu-id="c1c69-275">Методы `Map[Verb]` используют ограничения, чтобы ограничить маршрут к HTTP-команде в имени метода.</span><span class="sxs-lookup"><span data-stu-id="c1c69-275">The `Map[Verb]` methods use constraints to limit the route to the HTTP Verb in the method name.</span></span> <span data-ttu-id="c1c69-276">Например, см. класс <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> и тип <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>.</span><span class="sxs-lookup"><span data-stu-id="c1c69-276">For example, see <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> and <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>.</span></span>

## <a name="route-template-reference"></a><span data-ttu-id="c1c69-277">Справочник по шаблону маршрута</span><span class="sxs-lookup"><span data-stu-id="c1c69-277">Route template reference</span></span>

<span data-ttu-id="c1c69-278">Токены в фигурных скобках (`{ ... }`) определяют *параметры маршрута*, которые будут привязаны при совпадении маршрута.</span><span class="sxs-lookup"><span data-stu-id="c1c69-278">Tokens within curly braces (`{ ... }`) define *route parameters* that are bound if the route is matched.</span></span> <span data-ttu-id="c1c69-279">В сегменте маршрута можно определить несколько параметров маршрута, но они должны разделяться литеральным значением.</span><span class="sxs-lookup"><span data-stu-id="c1c69-279">You can define more than one route parameter in a route segment, but they must be separated by a literal value.</span></span> <span data-ttu-id="c1c69-280">Например, `{controller=Home}{action=Index}` будет недопустимым маршрутом, так как между `{controller}` и `{action}` нет литерального значения.</span><span class="sxs-lookup"><span data-stu-id="c1c69-280">For example, `{controller=Home}{action=Index}` isn't a valid route, since there's no literal value between `{controller}` and `{action}`.</span></span> <span data-ttu-id="c1c69-281">Эти параметры маршрута должны иметь имена, и для них могут быть определены дополнительные атрибуты.</span><span class="sxs-lookup"><span data-stu-id="c1c69-281">These route parameters must have a name and may have additional attributes specified.</span></span>

<span data-ttu-id="c1c69-282">Весь текст, кроме параметров маршрута (например, `{id}`) и разделителя пути `/`, должен соответствовать тексту в URL-адресе.</span><span class="sxs-lookup"><span data-stu-id="c1c69-282">Literal text other than route parameters (for example, `{id}`) and the path separator `/` must match the text in the URL.</span></span> <span data-ttu-id="c1c69-283">Сопоставление текста производится без учета регистра на основе декодированного представления путь URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="c1c69-283">Text matching is case-insensitive and based on the decoded representation of the URLs path.</span></span> <span data-ttu-id="c1c69-284">Для сопоставления с литеральным разделителем параметров маршрута `{` или `}` его следует экранировать путем повтора символа (`{{` или `}}`).</span><span class="sxs-lookup"><span data-stu-id="c1c69-284">To match the literal route parameter delimiter `{` or  `}`, escape it by repeating the character (`{{` or `}}`).</span></span>

<span data-ttu-id="c1c69-285">Шаблоны URL-адресов, которые пытаются получить имя файла с необязательным расширением, имеют свои особенности.</span><span class="sxs-lookup"><span data-stu-id="c1c69-285">URL patterns that attempt to capture a filename with an optional file extension have additional considerations.</span></span> <span data-ttu-id="c1c69-286">Например, рассмотрим шаблон `files/{filename}.{ext?}`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-286">For example, consider the template `files/{filename}.{ext?}`.</span></span> <span data-ttu-id="c1c69-287">Когда `filename` и `ext` существуют, заполняются оба значения.</span><span class="sxs-lookup"><span data-stu-id="c1c69-287">When both `filename` and `ext` exist, both values are populated.</span></span> <span data-ttu-id="c1c69-288">Если в URL-адресе есть только `filename`, маршрут совпадает, так как точка в конце `.` является необязательной.</span><span class="sxs-lookup"><span data-stu-id="c1c69-288">If only `filename` exists in the URL, the route matches because the trailing period `.` is  optional.</span></span> <span data-ttu-id="c1c69-289">Следующие URL-адреса соответствуют этому маршруту:</span><span class="sxs-lookup"><span data-stu-id="c1c69-289">The following URLs match this route:</span></span>

* `/files/myFile.txt`
* `/files/myFile`

<span data-ttu-id="c1c69-290">Вы можете использовать символ `*` в качестве префикса параметра маршрута для привязки к остальной части универсального кода ресурса (URI).</span><span class="sxs-lookup"><span data-stu-id="c1c69-290">You can use the `*` character as a prefix to a route parameter to bind to the rest of the URI.</span></span> <span data-ttu-id="c1c69-291">Такой параметр называется *универсальным*.</span><span class="sxs-lookup"><span data-stu-id="c1c69-291">This is called a *catch-all* parameter.</span></span> <span data-ttu-id="c1c69-292">Например, `blog/{*slug}` соответствует любому универсальному коду ресурса (URI), начинающемуся с сегмента `/blog`, за которым следует любое значение (присваиваемое в качестве значения маршрута `slug`).</span><span class="sxs-lookup"><span data-stu-id="c1c69-292">For example, `blog/{*slug}` matches any URI that starts with `/blog` and had any value following it (which is assigned to the `slug` route value).</span></span> <span data-ttu-id="c1c69-293">Универсальные параметры также могут соответствовать пустой строке.</span><span class="sxs-lookup"><span data-stu-id="c1c69-293">Catch-all parameters can also match the empty string.</span></span>

::: moniker range=">= aspnetcore-2.2"

<span data-ttu-id="c1c69-294">Универсальный параметр экранирует соответствующие символы, если маршрут использует для формирования URL-адрес, включая символы разделителей пути (`/`).</span><span class="sxs-lookup"><span data-stu-id="c1c69-294">The catch-all parameter escapes the appropriate characters when the route is used to generate a URL, including path separator (`/`) characters.</span></span> <span data-ttu-id="c1c69-295">Например, маршрут `foo/{*path}` со значениями маршрутов `{ path = "my/path" }` формирует `foo/my%2Fpath`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-295">For example, the route `foo/{*path}` with route values `{ path = "my/path" }` generates `foo/my%2Fpath`.</span></span> <span data-ttu-id="c1c69-296">Обратите внимание на экранированный знак косой черты.</span><span class="sxs-lookup"><span data-stu-id="c1c69-296">Note the escaped forward slash.</span></span> <span data-ttu-id="c1c69-297">В качестве символов разделителя кругового пути используйте префикс параметра маршрута `**`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-297">To round-trip path separator characters, use the `**` route parameter prefix.</span></span> <span data-ttu-id="c1c69-298">Маршрут `foo/{**path}` с `{ path = "my/path" }` формирует `foo/my/path`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-298">The route `foo/{**path}` with `{ path = "my/path" }` generates `foo/my/path`.</span></span>

::: moniker-end

<span data-ttu-id="c1c69-299">Параметры маршрута могут иметь *значения по умолчанию*. Они указываются после имени параметра и знака равенства (`=`).</span><span class="sxs-lookup"><span data-stu-id="c1c69-299">Route parameters may have *default values*, designated by specifying the default after the parameter name, separated by an equals sign (`=`).</span></span> <span data-ttu-id="c1c69-300">Например, `{controller=Home}` определяет `Home` в качестве значения по умолчанию для `controller`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-300">For example, `{controller=Home}` defines `Home` as the default value for `controller`.</span></span> <span data-ttu-id="c1c69-301">Значение по умолчанию используется, если для параметра нет значения в URL-адресе.</span><span class="sxs-lookup"><span data-stu-id="c1c69-301">The default value is used if no value is present in the URL for the parameter.</span></span> <span data-ttu-id="c1c69-302">Помимо значений по умолчанию, параметры маршрута могут быть необязательными (для этого необходимо добавить вопросительный знак (`?`) в конец имени параметра, например `id?`).</span><span class="sxs-lookup"><span data-stu-id="c1c69-302">In addition to default values, route parameters may be optional, specified by appending a question mark (`?`) to the end of the parameter name, as in `id?`.</span></span> <span data-ttu-id="c1c69-303">Различие между необязательными параметрами и параметрами маршрута по умолчанию в том, что вторые всегда имеют значения; необязательный параметр имеет значение, только если оно предоставлено URL-адресом запроса.</span><span class="sxs-lookup"><span data-stu-id="c1c69-303">The difference between optional values and default route parameters is that a route parameter with a default value always produces a value; an optional parameter has a value only when a value is provided by the request URL.</span></span>

::: moniker range=">= aspnetcore-2.2"

<span data-ttu-id="c1c69-304">Параметры маршрута могут иметь ограничения, которые должны соответствовать значению маршрута из URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="c1c69-304">Route parameters may have constraints, which must match the route value bound from the URL.</span></span> <span data-ttu-id="c1c69-305">Добавив двоеточие (`:`) и имя ограничения после имени параметра маршрута, можно указать *встроенные ограничения* для параметра маршрута.</span><span class="sxs-lookup"><span data-stu-id="c1c69-305">Adding a colon (`:`) and constraint name after the route parameter name specifies an *inline constraint* on a route parameter.</span></span> <span data-ttu-id="c1c69-306">Если для ограничения требуются аргументы, они указываются в скобках `( )` после имени ограничения.</span><span class="sxs-lookup"><span data-stu-id="c1c69-306">If the constraint requires arguments, they're enclosed in parentheses `( )` after the constraint name.</span></span> <span data-ttu-id="c1c69-307">Чтобы указать несколько встроенных ограничений, добавьте еще одно двоеточие (`:`) и имя ограничения.</span><span class="sxs-lookup"><span data-stu-id="c1c69-307">Multiple inline constraints can be specified by appending another colon (`:`) and constraint name.</span></span> <span data-ttu-id="c1c69-308">Имя и аргументы ограничения передаются в службу <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> для создания экземпляра интерфейса <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>, который будет использоваться при обработке URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="c1c69-308">The constraint name and arguments are passed to the <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> service to create an instance of <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> to use in URL processing.</span></span> <span data-ttu-id="c1c69-309">Если конструктору ограничения требуются службы, они разрешаются из служб приложений внедрения зависимостей.</span><span class="sxs-lookup"><span data-stu-id="c1c69-309">If the constraint constructor requires services, they're resolved from dependency injection's app services.</span></span> <span data-ttu-id="c1c69-310">Например, в шаблоне маршрута `blog/{article:minlength(10)}` определяется ограничение `minlength` с аргументом `10`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-310">For example, the route template `blog/{article:minlength(10)}` specifies a `minlength` constraint with the argument `10`.</span></span> <span data-ttu-id="c1c69-311">Более подробное описание ограничений маршрутов и список ограничений, предоставляемых платформой, см. в разделе [Справочник по ограничениям маршрутов](#route-constraint-reference).</span><span class="sxs-lookup"><span data-stu-id="c1c69-311">For more information on route constraints and a listing of the constraints provided by the framework, see the [Route constraint reference](#route-constraint-reference) section.</span></span>

::: moniker-end

::: moniker range="< aspnetcore-2.2"

<span data-ttu-id="c1c69-312">Параметры маршрута могут иметь ограничения, которые должны соответствовать значению маршрута из URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="c1c69-312">Route parameters may have constraints, which must match the route value bound from the URL.</span></span> <span data-ttu-id="c1c69-313">Добавив двоеточие (`:`) и имя ограничения после имени параметра маршрута, можно указать *встроенные ограничения* для параметра маршрута.</span><span class="sxs-lookup"><span data-stu-id="c1c69-313">Adding a colon (`:`) and constraint name after the route parameter name specifies an *inline constraint* on a route parameter.</span></span> <span data-ttu-id="c1c69-314">Если для ограничения требуются аргументы, они указываются в скобках `( )` после имени ограничения.</span><span class="sxs-lookup"><span data-stu-id="c1c69-314">If the constraint requires arguments, they're enclosed in parentheses `( )` after the constraint name.</span></span> <span data-ttu-id="c1c69-315">Чтобы указать несколько встроенных ограничений, добавьте еще одно двоеточие (`:`) и имя ограничения.</span><span class="sxs-lookup"><span data-stu-id="c1c69-315">Multiple inline constraints can be specified by appending another colon (`:`) and constraint name.</span></span> <span data-ttu-id="c1c69-316">Имя и аргументы ограничения передаются в службу <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> для создания экземпляра интерфейса <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>, который будет использоваться при обработке URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="c1c69-316">The constraint name and arguments are passed to the <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> service to create an instance of <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> to use in URL processing.</span></span> <span data-ttu-id="c1c69-317">Например, в шаблоне маршрута `blog/{article:minlength(10)}` определяется ограничение `minlength` с аргументом `10`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-317">For example, the route template `blog/{article:minlength(10)}` specifies a `minlength` constraint with the argument `10`.</span></span> <span data-ttu-id="c1c69-318">Более подробное описание ограничений маршрутов и список ограничений, предоставляемых платформой, см. в разделе [Справочник по ограничениям маршрутов](#route-constraint-reference).</span><span class="sxs-lookup"><span data-stu-id="c1c69-318">For more information on route constraints and a listing of the constraints provided by the framework, see the [Route constraint reference](#route-constraint-reference) section.</span></span>

::: moniker-end

::: moniker range=">= aspnetcore-2.2"

<span data-ttu-id="c1c69-319">Параметры маршрута также могут иметь преобразователи параметров, которые преобразуют значение параметра при создании ссылок и сопоставлении действий и страниц с URI.</span><span class="sxs-lookup"><span data-stu-id="c1c69-319">Route parameters may also have parameter transformers, which transform a parameter's value when generating links and matching actions and pages to URIs.</span></span> <span data-ttu-id="c1c69-320">Как и ограничения, преобразователи параметров можно включать в параметр маршрута, добавив двоеточие (`:`) и имя преобразователя после имени параметра маршрута.</span><span class="sxs-lookup"><span data-stu-id="c1c69-320">Like constraints, parameter transformers can be added inline to a route parameter by adding a colon (`:`) and transformer name after the route parameter name.</span></span> <span data-ttu-id="c1c69-321">Например, шаблон маршрута `blog/{article:slugify}` задает преобразователь `slugify`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-321">For example, the route template `blog/{article:slugify}` specifies a `slugify` transformer.</span></span>

::: moniker-end

<span data-ttu-id="c1c69-322">В приведенной ниже таблице показаны некоторые шаблоны маршрутов и их поведение.</span><span class="sxs-lookup"><span data-stu-id="c1c69-322">The following table demonstrates some route templates and their behavior.</span></span>

| <span data-ttu-id="c1c69-323">Шаблон маршрута</span><span class="sxs-lookup"><span data-stu-id="c1c69-323">Route Template</span></span>                         | <span data-ttu-id="c1c69-324">Пример соответствующего URL-адреса</span><span class="sxs-lookup"><span data-stu-id="c1c69-324">Example Matching URL</span></span>  | <span data-ttu-id="c1c69-325">Примечания</span><span class="sxs-lookup"><span data-stu-id="c1c69-325">Notes</span></span>                                                                  |
| -------------------------------------- | --------------------- | ---------------------------------------------------------------------- |
| <span data-ttu-id="c1c69-326">hello</span><span class="sxs-lookup"><span data-stu-id="c1c69-326">hello</span></span>                                  | <span data-ttu-id="c1c69-327">/hello</span><span class="sxs-lookup"><span data-stu-id="c1c69-327">/hello</span></span>                | <span data-ttu-id="c1c69-328">Соответствует только одному пути `/hello`</span><span class="sxs-lookup"><span data-stu-id="c1c69-328">Only matches the single path `/hello`</span></span>                                  |
| <span data-ttu-id="c1c69-329">{Page=Home}</span><span class="sxs-lookup"><span data-stu-id="c1c69-329">{Page=Home}</span></span>                            | /                     | <span data-ttu-id="c1c69-330">Соответствует и задает для параметра `Page` значение `Home`</span><span class="sxs-lookup"><span data-stu-id="c1c69-330">Matches and sets `Page` to `Home`</span></span>                                      |
| <span data-ttu-id="c1c69-331">{Page=Home}</span><span class="sxs-lookup"><span data-stu-id="c1c69-331">{Page=Home}</span></span>                            | <span data-ttu-id="c1c69-332">/Contact</span><span class="sxs-lookup"><span data-stu-id="c1c69-332">/Contact</span></span>              | <span data-ttu-id="c1c69-333">Соответствует и задает для параметра `Page` значение `Contact`</span><span class="sxs-lookup"><span data-stu-id="c1c69-333">Matches and sets `Page` to `Contact`</span></span>                                   |
| <span data-ttu-id="c1c69-334">{controller}/{action}/{id?}</span><span class="sxs-lookup"><span data-stu-id="c1c69-334">{controller}/{action}/{id?}</span></span>            | <span data-ttu-id="c1c69-335">/Products/List</span><span class="sxs-lookup"><span data-stu-id="c1c69-335">/Products/List</span></span>        | <span data-ttu-id="c1c69-336">Сопоставляется с контроллером `Products` и действием `List`</span><span class="sxs-lookup"><span data-stu-id="c1c69-336">Maps to `Products` controller and `List`  action</span></span>                       |
| <span data-ttu-id="c1c69-337">{controller}/{action}/{id?}</span><span class="sxs-lookup"><span data-stu-id="c1c69-337">{controller}/{action}/{id?}</span></span>            | <span data-ttu-id="c1c69-338">/Products/Details/123</span><span class="sxs-lookup"><span data-stu-id="c1c69-338">/Products/Details/123</span></span> |  <span data-ttu-id="c1c69-339">Сопоставляется с контроллером `Products` и действием `Details`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-339">Maps to `Products` controller and  `Details` action.</span></span>  <span data-ttu-id="c1c69-340">`id` присваивается значение 123</span><span class="sxs-lookup"><span data-stu-id="c1c69-340">`id` set to 123</span></span> |
| <span data-ttu-id="c1c69-341">{controller=Home}/{action=Index}/{id?}</span><span class="sxs-lookup"><span data-stu-id="c1c69-341">{controller=Home}/{action=Index}/{id?}</span></span> | /                     |  <span data-ttu-id="c1c69-342">Сопоставляется с контроллером `Home` и методом `Index`; `id` пропускается.</span><span class="sxs-lookup"><span data-stu-id="c1c69-342">Maps to `Home` controller and `Index`  method; `id` is ignored.</span></span>       |

<span data-ttu-id="c1c69-343">Использование шаблона — это, как правило, самый простой подход к маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="c1c69-343">Using a template is generally the simplest approach to routing.</span></span> <span data-ttu-id="c1c69-344">Ограничения и значения по умолчанию также могут указываться вне шаблона маршрута.</span><span class="sxs-lookup"><span data-stu-id="c1c69-344">Constraints and defaults can also be specified outside the route template.</span></span>

> [!TIP]
> <span data-ttu-id="c1c69-345">Чтобы увидеть, как встроенные реализации маршрутизации, такие как `Route`, сопоставляются с запросами, включите [ведение журнала](xref:fundamentals/logging/index).</span><span class="sxs-lookup"><span data-stu-id="c1c69-345">Enable [Logging](xref:fundamentals/logging/index) to see how the built in routing implementations, such as `Route`, match requests.</span></span>

## <a name="reserved-routing-names"></a><span data-ttu-id="c1c69-346">Зарезервированные имена маршрутизации</span><span class="sxs-lookup"><span data-stu-id="c1c69-346">Reserved routing names</span></span>

<span data-ttu-id="c1c69-347">Следующие ключевые слова являются зарезервированными именами и не могут использоваться как имена маршрутов или параметры:</span><span class="sxs-lookup"><span data-stu-id="c1c69-347">The following keywords are reserved names and can't be used as route names or parameters:</span></span>

* `action`
* `area`
* `controller`
* `handler`
* `page`

## <a name="route-constraint-reference"></a><span data-ttu-id="c1c69-348">Справочник по ограничениям маршрутов</span><span class="sxs-lookup"><span data-stu-id="c1c69-348">Route constraint reference</span></span>

<span data-ttu-id="c1c69-349">Ограничения маршрута применяются, когда объект `Route` соответствует синтаксису входящего URL-адреса и путь URL-адреса был разобран на значения маршрута.</span><span class="sxs-lookup"><span data-stu-id="c1c69-349">Route constraints execute when a `Route` has matched the syntax of the incoming URL and tokenized the URL path into route values.</span></span> <span data-ttu-id="c1c69-350">Как правило, ограничения маршрута служат для проверки значения маршрута, связанного посредством шаблона маршрута, и принятия решения касательно того, является ли значение приемлемым (да или нет).</span><span class="sxs-lookup"><span data-stu-id="c1c69-350">Route constraints generally inspect the route value associated via the route template and make a yes/no decision about whether or not the value is acceptable.</span></span> <span data-ttu-id="c1c69-351">Некоторые ограничения маршрута используют данные, не относящиеся к значению маршрута, для определения возможности маршрутизации запроса.</span><span class="sxs-lookup"><span data-stu-id="c1c69-351">Some route constraints use data outside the route value to consider whether the request can be routed.</span></span> <span data-ttu-id="c1c69-352">Например, <xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> может принимать или отклонять запрос в зависимости от HTTP-команды.</span><span class="sxs-lookup"><span data-stu-id="c1c69-352">For example, the <xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> can accept or reject a request based on its HTTP verb.</span></span>

> [!WARNING]
> <span data-ttu-id="c1c69-353">Старайтесь не использовать ограничения для **проверки входных данных**, так как в результате недопустимые входные данные будут вызывать ошибку *404 (не найдено)* вместо ошибки *400 (неверный запрос)* с соответствующим сообщением.</span><span class="sxs-lookup"><span data-stu-id="c1c69-353">Avoid using constraints for **input validation** because doing so means that invalid input results in a *404 - Not Found* response instead of a *400 - Bad Request* with an appropriate error message.</span></span> <span data-ttu-id="c1c69-354">Ограничения маршрутов следует использовать для **разрешения неоднозначности** похожих маршрутов, а не для проверки входных данных определенного маршрута.</span><span class="sxs-lookup"><span data-stu-id="c1c69-354">Route constraints are used to **disambiguate** between similar routes, not to validate the inputs for a particular route.</span></span>

<span data-ttu-id="c1c69-355">В приведенной ниже таблице показаны некоторые ограничения маршрутов и их ожидаемое поведение.</span><span class="sxs-lookup"><span data-stu-id="c1c69-355">The following table demonstrates some route constraints and their expected behavior.</span></span>

| <span data-ttu-id="c1c69-356">ограничение</span><span class="sxs-lookup"><span data-stu-id="c1c69-356">constraint</span></span> | <span data-ttu-id="c1c69-357">Пример</span><span class="sxs-lookup"><span data-stu-id="c1c69-357">Example</span></span> | <span data-ttu-id="c1c69-358">Примеры совпадений</span><span class="sxs-lookup"><span data-stu-id="c1c69-358">Example Matches</span></span> | <span data-ttu-id="c1c69-359">Примечания</span><span class="sxs-lookup"><span data-stu-id="c1c69-359">Notes</span></span> |
| ---------- | ------- | --------------- | ----- |
| `int` | `{id:int}` | <span data-ttu-id="c1c69-360">`123456789`, `-123456789`</span><span class="sxs-lookup"><span data-stu-id="c1c69-360">`123456789`, `-123456789`</span></span>  | <span data-ttu-id="c1c69-361">Соответствует любому целому числу</span><span class="sxs-lookup"><span data-stu-id="c1c69-361">Matches any integer</span></span> |
| `bool` | `{active:bool}` | <span data-ttu-id="c1c69-362">`true`, `FALSE`</span><span class="sxs-lookup"><span data-stu-id="c1c69-362">`true`, `FALSE`</span></span> | <span data-ttu-id="c1c69-363">Соответствует `true` или `false` (без учета регистра)</span><span class="sxs-lookup"><span data-stu-id="c1c69-363">Matches `true` or `false` (case-insensitive)</span></span> |
| `datetime` | `{dob:datetime}` | <span data-ttu-id="c1c69-364">`2016-12-31`, `2016-12-31 7:32pm`</span><span class="sxs-lookup"><span data-stu-id="c1c69-364">`2016-12-31`, `2016-12-31 7:32pm`</span></span>  | <span data-ttu-id="c1c69-365">Соответствует допустимому значению `DateTime` (для инвариантного языка и региональных параметров — см. предупреждение)</span><span class="sxs-lookup"><span data-stu-id="c1c69-365">Matches a valid `DateTime` value (in the invariant culture - see warning)</span></span> |
| `decimal` | `{price:decimal}` | <span data-ttu-id="c1c69-366">`49.99`, `-1,000.01`</span><span class="sxs-lookup"><span data-stu-id="c1c69-366">`49.99`, `-1,000.01`</span></span> | <span data-ttu-id="c1c69-367">Соответствует допустимому значению `decimal` (для инвариантного языка и региональных параметров — см. предупреждение)</span><span class="sxs-lookup"><span data-stu-id="c1c69-367">Matches a valid `decimal` value (in the invariant culture - see warning)</span></span> |
| `double` | `{weight:double}` | <span data-ttu-id="c1c69-368">`1.234`, `-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="c1c69-368">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="c1c69-369">Соответствует допустимому значению `double` (для инвариантного языка и региональных параметров — см. предупреждение)</span><span class="sxs-lookup"><span data-stu-id="c1c69-369">Matches a valid `double` value (in the invariant culture - see warning)</span></span> |
| `float` | `{weight:float}` | <span data-ttu-id="c1c69-370">`1.234`, `-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="c1c69-370">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="c1c69-371">Соответствует допустимому значению `float` (для инвариантного языка и региональных параметров — см. предупреждение)</span><span class="sxs-lookup"><span data-stu-id="c1c69-371">Matches a valid `float` value (in the invariant culture - see warning)</span></span> |
| `guid` | `{id:guid}` | <span data-ttu-id="c1c69-372">`CD2C1638-1638-72D5-1638-DEADBEEF1638`, `{CD2C1638-1638-72D5-1638-DEADBEEF1638}`</span><span class="sxs-lookup"><span data-stu-id="c1c69-372">`CD2C1638-1638-72D5-1638-DEADBEEF1638`, `{CD2C1638-1638-72D5-1638-DEADBEEF1638}`</span></span> | <span data-ttu-id="c1c69-373">Соответствует допустимому значению `Guid`</span><span class="sxs-lookup"><span data-stu-id="c1c69-373">Matches a valid `Guid` value</span></span> |
| `long` | `{ticks:long}` | <span data-ttu-id="c1c69-374">`123456789`, `-123456789`</span><span class="sxs-lookup"><span data-stu-id="c1c69-374">`123456789`, `-123456789`</span></span> | <span data-ttu-id="c1c69-375">Соответствует допустимому значению `long`</span><span class="sxs-lookup"><span data-stu-id="c1c69-375">Matches a valid `long` value</span></span> |
| `minlength(value)` | `{username:minlength(4)}` | `Rick` | <span data-ttu-id="c1c69-376">Строка должна содержать не менее 4 символов</span><span class="sxs-lookup"><span data-stu-id="c1c69-376">String must be at least 4 characters</span></span> |
| `maxlength(value)` | `{filename:maxlength(8)}` | `Richard` | <span data-ttu-id="c1c69-377">Строка должна содержать не более 8 символов</span><span class="sxs-lookup"><span data-stu-id="c1c69-377">String must be no more than 8 characters</span></span> |
| `length(length)` | `{filename:length(12)}` | `somefile.txt` | <span data-ttu-id="c1c69-378">Длина строки должна составлять ровно 12 символов</span><span class="sxs-lookup"><span data-stu-id="c1c69-378">String must be exactly 12 characters long</span></span> |
| `length(min,max)` | `{filename:length(8,16)}` | `somefile.txt` | <span data-ttu-id="c1c69-379">Строка должна содержать от 8 до 16 символов</span><span class="sxs-lookup"><span data-stu-id="c1c69-379">String must be at least 8 and no more than 16 characters long</span></span> |
| `min(value)` | `{age:min(18)}` | `19` | <span data-ttu-id="c1c69-380">Целочисленное значение не меньше 18</span><span class="sxs-lookup"><span data-stu-id="c1c69-380">Integer value must be at least 18</span></span> |
| `max(value)` | `{age:max(120)}` | `91` | <span data-ttu-id="c1c69-381">Целочисленное значение не больше 120</span><span class="sxs-lookup"><span data-stu-id="c1c69-381">Integer value must be no more than 120</span></span> |
| `range(min,max)` | `{age:range(18,120)}` | `91` | <span data-ttu-id="c1c69-382">Целочисленное значение от 18 до 120</span><span class="sxs-lookup"><span data-stu-id="c1c69-382">Integer value must be at least 18 but no more than 120</span></span> |
| `alpha` | `{name:alpha}` | `Rick` | <span data-ttu-id="c1c69-383">Строка должна состоять из одной или нескольких букв (`a`-`z`, без учета регистра)</span><span class="sxs-lookup"><span data-stu-id="c1c69-383">String must consist of one or more alphabetical characters (`a`-`z`, case-insensitive)</span></span> |
| `regex(expression)` | `{ssn:regex(^\\d{{3}}-\\d{{2}}-\\d{{4}}$)}` | `123-45-6789` | <span data-ttu-id="c1c69-384">Строка должна соответствовать регулярному выражению (см. советы по определению регулярного выражения)</span><span class="sxs-lookup"><span data-stu-id="c1c69-384">String must match the regular expression (see tips about defining a regular expression)</span></span> |
| `required` | `{name:required}` | `Rick` |  <span data-ttu-id="c1c69-385">Определяет обязательное наличие значения, не относящегося к параметру, во время формирования URL-адреса</span><span class="sxs-lookup"><span data-stu-id="c1c69-385">Used to enforce that a non-parameter value is present during URL generation</span></span> |

<span data-ttu-id="c1c69-386">К одному параметру может применяться несколько разделенных запятой ограничений.</span><span class="sxs-lookup"><span data-stu-id="c1c69-386">Multiple, colon-delimited constraints can be applied to a single parameter.</span></span> <span data-ttu-id="c1c69-387">Например, следующее ограничение ограничивает параметр целочисленным значением 1 или больше:</span><span class="sxs-lookup"><span data-stu-id="c1c69-387">For example, the following constraint restricts a parameter to an integer value of 1 or greater:</span></span>

```csharp
[Route("users/{id:int:min(1)}")]
public User GetUserById(int id) { }
```

> [!WARNING]
> <span data-ttu-id="c1c69-388">Ограничения маршрута, которые проверяют URL-адрес и могут быть преобразованы в тип CLR (например, `int` или `DateTime`), всегда используют инвариантные язык и региональные параметры.</span><span class="sxs-lookup"><span data-stu-id="c1c69-388">Route constraints that verify the URL and are converted to a CLR type (such as `int` or `DateTime`) always use the invariant culture.</span></span> <span data-ttu-id="c1c69-389">Эти ограничения предполагают, что URL-адрес является нелокализуемым.</span><span class="sxs-lookup"><span data-stu-id="c1c69-389">These constraints assume that the URL is non-localizable.</span></span> <span data-ttu-id="c1c69-390">Предоставляемые платформой ограничения маршрутов не изменяют значения, хранящиеся в значениях маршрута.</span><span class="sxs-lookup"><span data-stu-id="c1c69-390">The framework-provided route constraints don't modify the values stored in route values.</span></span> <span data-ttu-id="c1c69-391">Все значения маршрута, переданные из URL-адреса, сохраняются как строки.</span><span class="sxs-lookup"><span data-stu-id="c1c69-391">All route values parsed from the URL are stored as strings.</span></span> <span data-ttu-id="c1c69-392">Например, ограничение `float` пытается преобразовать значение маршрута в число с плавающей запятой, но преобразованное значение служит только для проверки возможности такого преобразования.</span><span class="sxs-lookup"><span data-stu-id="c1c69-392">For example, the `float` constraint attempts to convert the route value to a float, but the converted value is used only to verify it can be converted to a float.</span></span>

## <a name="regular-expressions"></a><span data-ttu-id="c1c69-393">Регулярные выражения</span><span class="sxs-lookup"><span data-stu-id="c1c69-393">Regular expressions</span></span>

<span data-ttu-id="c1c69-394">В платформе ASP.NET Core в конструктор регулярных выражений добавляются члены `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-394">The ASP.NET Core framework adds `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant` to the regular expression constructor.</span></span> <span data-ttu-id="c1c69-395">Описание этих членов см. в разделе <xref:System.Text.RegularExpressions.RegexOptions>.</span><span class="sxs-lookup"><span data-stu-id="c1c69-395">See <xref:System.Text.RegularExpressions.RegexOptions> for a description of these members.</span></span>

<span data-ttu-id="c1c69-396">В регулярных выражениях применяются разделители и токены, аналогичные используемым функцией маршрутизации и в языке C#.</span><span class="sxs-lookup"><span data-stu-id="c1c69-396">Regular expressions use delimiters and tokens similar to those used by Routing and the C# language.</span></span> <span data-ttu-id="c1c69-397">Токены регулярного выражения должны быть экранированы.</span><span class="sxs-lookup"><span data-stu-id="c1c69-397">Regular expression tokens must be escaped.</span></span> <span data-ttu-id="c1c69-398">Чтобы использовать регулярное выражение `^\d{3}-\d{2}-\d{4}$` при маршрутизации, выражение должно иметь символы `\` в виде `\\` в исходном файле C# для экранирования escape-символов строки `\` (если не используются [буквальные строковые литералы](/dotnet/csharp/language-reference/keywords/string)).</span><span class="sxs-lookup"><span data-stu-id="c1c69-398">To use the regular expression `^\d{3}-\d{2}-\d{4}$` in Routing, the expression must have the `\` characters typed in as `\\` in the C# source file to escape the `\` string escape character (unless using [verbatim string literals](/dotnet/csharp/language-reference/keywords/string).</span></span> <span data-ttu-id="c1c69-399">Символы `{`, `}`, `[` и `]` необходимо экранировать путем их удвоения, чтобы экранировать символы-разделители параметров маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="c1c69-399">The `{`, `}`, `[`, and `]` characters must be escaped by doubling them to escape the Routing parameter delimiter characters.</span></span> <span data-ttu-id="c1c69-400">В приведенной ниже таблице показаны регулярные выражения и их экранированные варианты.</span><span class="sxs-lookup"><span data-stu-id="c1c69-400">The table below shows a regular expression and the escaped version.</span></span>

| <span data-ttu-id="c1c69-401">Выражение</span><span class="sxs-lookup"><span data-stu-id="c1c69-401">Expression</span></span>            | <span data-ttu-id="c1c69-402">Экранированное</span><span class="sxs-lookup"><span data-stu-id="c1c69-402">Escaped</span></span>                        |
| --------------------- | ------------------------------ |
| `^\d{3}-\d{2}-\d{4}$` | `^\\d{{3}}-\\d{{2}}-\\d{{4}}$` |
| `^[a-z]{2}$`          | `^[[a-z]]{{2}}$`               |

<span data-ttu-id="c1c69-403">Регулярные выражения, используемые при маршрутизации, часто начинаются с символа `^` (соответствие с начальной позицией строки) и заканчиваются символом `$` (соответствие с конечной позицией строки).</span><span class="sxs-lookup"><span data-stu-id="c1c69-403">Regular expressions used in routing often start with the `^` character (match starting position of the string) and end with the `$` character (match ending position of the string).</span></span> <span data-ttu-id="c1c69-404">Благодаря символам `^` и `$` регулярное выражение сопоставляется со всем значением параметра маршрута.</span><span class="sxs-lookup"><span data-stu-id="c1c69-404">The `^` and `$` characters ensure that the regular expression match the entire route parameter value.</span></span> <span data-ttu-id="c1c69-405">Если символы `^` и `$` отсутствуют, регулярное выражение сопоставляется с любой подстрокой внутри строки, что обычно нежелательно.</span><span class="sxs-lookup"><span data-stu-id="c1c69-405">Without the `^` and `$` characters, the regular expression match any substring within the string, which is often undesirable.</span></span> <span data-ttu-id="c1c69-406">В приведенной ниже таблице представлен ряд примеров и объясняются причины соответствия или несоответствия.</span><span class="sxs-lookup"><span data-stu-id="c1c69-406">The table below shows some examples and explains why they match or fail to match.</span></span>

| <span data-ttu-id="c1c69-407">Выражение</span><span class="sxs-lookup"><span data-stu-id="c1c69-407">Expression</span></span>   | <span data-ttu-id="c1c69-408">String</span><span class="sxs-lookup"><span data-stu-id="c1c69-408">String</span></span>    | <span data-ttu-id="c1c69-409">Соответствие</span><span class="sxs-lookup"><span data-stu-id="c1c69-409">Match</span></span> | <span data-ttu-id="c1c69-410">Комментарий</span><span class="sxs-lookup"><span data-stu-id="c1c69-410">Comment</span></span>               |
| ------------ | --------- |  ---- |  -------------------- |
| `[a-z]{2}`   | <span data-ttu-id="c1c69-411">hello</span><span class="sxs-lookup"><span data-stu-id="c1c69-411">hello</span></span>     | <span data-ttu-id="c1c69-412">Да</span><span class="sxs-lookup"><span data-stu-id="c1c69-412">Yes</span></span>   | <span data-ttu-id="c1c69-413">Соответствие подстроки</span><span class="sxs-lookup"><span data-stu-id="c1c69-413">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="c1c69-414">123abc456</span><span class="sxs-lookup"><span data-stu-id="c1c69-414">123abc456</span></span> | <span data-ttu-id="c1c69-415">Да</span><span class="sxs-lookup"><span data-stu-id="c1c69-415">Yes</span></span>   | <span data-ttu-id="c1c69-416">Соответствие подстроки</span><span class="sxs-lookup"><span data-stu-id="c1c69-416">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="c1c69-417">mz</span><span class="sxs-lookup"><span data-stu-id="c1c69-417">mz</span></span>        | <span data-ttu-id="c1c69-418">Да</span><span class="sxs-lookup"><span data-stu-id="c1c69-418">Yes</span></span>   | <span data-ttu-id="c1c69-419">Соответствует выражению</span><span class="sxs-lookup"><span data-stu-id="c1c69-419">Matches expression</span></span>    |
| `[a-z]{2}`   | <span data-ttu-id="c1c69-420">MZ</span><span class="sxs-lookup"><span data-stu-id="c1c69-420">MZ</span></span>        | <span data-ttu-id="c1c69-421">Да</span><span class="sxs-lookup"><span data-stu-id="c1c69-421">Yes</span></span>   | <span data-ttu-id="c1c69-422">Без учета регистра</span><span class="sxs-lookup"><span data-stu-id="c1c69-422">Not case sensitive</span></span>    |
| `^[a-z]{2}$` |  <span data-ttu-id="c1c69-423">hello</span><span class="sxs-lookup"><span data-stu-id="c1c69-423">hello</span></span>    | <span data-ttu-id="c1c69-424">Нет</span><span class="sxs-lookup"><span data-stu-id="c1c69-424">No</span></span>    | <span data-ttu-id="c1c69-425">См. замечания, касающиеся символов `^` и `$`, выше</span><span class="sxs-lookup"><span data-stu-id="c1c69-425">See `^` and `$` above</span></span> |
| `^[a-z]{2}$` | <span data-ttu-id="c1c69-426">123abc456</span><span class="sxs-lookup"><span data-stu-id="c1c69-426">123abc456</span></span> | <span data-ttu-id="c1c69-427">Нет</span><span class="sxs-lookup"><span data-stu-id="c1c69-427">No</span></span>    | <span data-ttu-id="c1c69-428">См. замечания, касающиеся символов `^` и `$`, выше</span><span class="sxs-lookup"><span data-stu-id="c1c69-428">See `^` and `$` above</span></span> |

<span data-ttu-id="c1c69-429">Дополнительные сведения о синтаксисе регулярных выражений см. в статье [Регулярные выражения в .NET Framework](/dotnet/standard/base-types/regular-expression-language-quick-reference).</span><span class="sxs-lookup"><span data-stu-id="c1c69-429">For more information on regular expression syntax, see [.NET Framework Regular Expressions](/dotnet/standard/base-types/regular-expression-language-quick-reference).</span></span>

<span data-ttu-id="c1c69-430">Чтобы ограничить возможные значения параметра набором известных значений, используйте регулярное выражение.</span><span class="sxs-lookup"><span data-stu-id="c1c69-430">To constrain a parameter to a known set of possible values, use a regular expression.</span></span> <span data-ttu-id="c1c69-431">Например, при использовании выражения `{action:regex(^(list|get|create)$)}` значение маршрута `action` будет соответствовать только `list`, `get` или `create`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-431">For example, `{action:regex(^(list|get|create)$)}` only matches the `action` route value to `list`, `get`, or `create`.</span></span> <span data-ttu-id="c1c69-432">При передаче в словарь ограничений строка `^(list|get|create)$` будет эквивалентной.</span><span class="sxs-lookup"><span data-stu-id="c1c69-432">If passed into the constraints dictionary, the string `^(list|get|create)$` is equivalent.</span></span> <span data-ttu-id="c1c69-433">Ограничения, которые передаются в словарь ограничений (то есть не являются встроенными ограничениями шаблона) и не соответствуют одному из известных ограничений, также рассматриваются как регулярные выражения.</span><span class="sxs-lookup"><span data-stu-id="c1c69-433">Constraints that are passed in the constraints dictionary (not inline within a template) that don't match one of the known constraints are also treated as regular expressions.</span></span>

::: moniker range=">= aspnetcore-2.2"

## <a name="parameter-transformer-reference"></a><span data-ttu-id="c1c69-434">Справочник по преобразователям параметров</span><span class="sxs-lookup"><span data-stu-id="c1c69-434">Parameter transformer reference</span></span>

<span data-ttu-id="c1c69-435">Преобразователи параметров:</span><span class="sxs-lookup"><span data-stu-id="c1c69-435">Parameter transformers:</span></span>

* <span data-ttu-id="c1c69-436">Выполняются при формировании ссылки для `Route`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-436">Execute when generating a link for a `Route`.</span></span>
* <span data-ttu-id="c1c69-437">Реализуйте расширение `Microsoft.AspNetCore.Routing.IOutboundParameterTransformer`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-437">Implement `Microsoft.AspNetCore.Routing.IOutboundParameterTransformer`.</span></span>
* <span data-ttu-id="c1c69-438">Настраиваются с помощью <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap>.</span><span class="sxs-lookup"><span data-stu-id="c1c69-438">Are configured using <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap>.</span></span>
* <span data-ttu-id="c1c69-439">Принимают значение маршрута параметра и изменяют его на новое строковое значение.</span><span class="sxs-lookup"><span data-stu-id="c1c69-439">Take the parameter's route value and transform it to a new string value.</span></span>
* <span data-ttu-id="c1c69-440">Преобразованное значение используется в сформированной ссылке.</span><span class="sxs-lookup"><span data-stu-id="c1c69-440">The transformed value is used in the generated link.</span></span>

<span data-ttu-id="c1c69-441">Например, пользовательский преобразователь параметра `slugify` в шаблоне маршрута `blog\{article:slugify}` с `Url.Action(new { article = "MyTestArticle" })` формирует значение `blog\my-test-article`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-441">For example, a custom `slugify` parameter transformer in route pattern `blog\{article:slugify}` with `Url.Action(new { article = "MyTestArticle" })` generates `blog\my-test-article`.</span></span>

<span data-ttu-id="c1c69-442">Преобразователи параметров также используются платформами для преобразования URI, в который разрешается конечная точка.</span><span class="sxs-lookup"><span data-stu-id="c1c69-442">Parameter transformers are also used by frameworks to transform the URI to which an endpoint resolves.</span></span> <span data-ttu-id="c1c69-443">Например, ASP.NET Core MVC с помощью преобразователей параметров преобразует значение маршрута, используемое для сопоставления `area`, `controller`, `action` и `page`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-443">For example, ASP.NET Core MVC uses parameter transformers to transform the route value used to match an `area`, `controller`, `action`, and `page`.</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home:slugify}/{action=Index:slugify}/{id?}");
```

<span data-ttu-id="c1c69-444">С помощью предыдущего маршрута действие `SubscriptionManagementController.GetAll()` сопоставляется с URI `/subscription-management/get-all`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-444">With the preceding route, the action `SubscriptionManagementController.GetAll()` is matched with the URI `/subscription-management/get-all`.</span></span> <span data-ttu-id="c1c69-445">Преобразователь параметра не изменяет значения маршрута, используемые для формирования ссылки.</span><span class="sxs-lookup"><span data-stu-id="c1c69-445">A parameter transformer doesn't change the route values used to generate a link.</span></span> <span data-ttu-id="c1c69-446">`Url.Action("GetAll", "SubscriptionManagement")` дает в результате `/subscription-management/get-all`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-446">`Url.Action("GetAll", "SubscriptionManagement")` outputs `/subscription-management/get-all`.</span></span>

<span data-ttu-id="c1c69-447">ASP.NET Core предоставляет соглашения об API для использования преобразователей параметров со сформированными маршрутами:</span><span class="sxs-lookup"><span data-stu-id="c1c69-447">ASP.NET Core provides API conventions for using a parameter transformers with generated routes:</span></span>

* <span data-ttu-id="c1c69-448">ASP.NET Core MVC поддерживает соглашение об API `Microsoft.AspNetCore.Mvc.ApplicationModels.RouteTokenTransformerConvention`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-448">ASP.NET Core MVC has the `Microsoft.AspNetCore.Mvc.ApplicationModels.RouteTokenTransformerConvention` API convention.</span></span> <span data-ttu-id="c1c69-449">Это соглашение применяет указанный преобразователь параметров ко всем маршрутам атрибутов в приложении.</span><span class="sxs-lookup"><span data-stu-id="c1c69-449">This convention applies a specified parameter transformer to all attribute routes in the app.</span></span> <span data-ttu-id="c1c69-450">Преобразователь параметров преобразует маркеры маршрутов атрибутов по мере их замены.</span><span class="sxs-lookup"><span data-stu-id="c1c69-450">The parameter transformer transforms attribute route tokens as they are replaced.</span></span> <span data-ttu-id="c1c69-451">Дополнительные сведения см. в разделе об [использовании преобразователя параметров для настройки замены маркеров](/aspnet/core/mvc/controllers/routing#use-a-parameter-transformer-to-customize-token-replacement).</span><span class="sxs-lookup"><span data-stu-id="c1c69-451">For more information, see [Use a parameter transformer to customize token replacement](/aspnet/core/mvc/controllers/routing#use-a-parameter-transformer-to-customize-token-replacement).</span></span>
* <span data-ttu-id="c1c69-452">Страницы Razor поддерживают соглашение об API `Microsoft.AspNetCore.Mvc.ApplicationModels.PageRouteTransformerConvention`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-452">Razor pages has the `Microsoft.AspNetCore.Mvc.ApplicationModels.PageRouteTransformerConvention` API convention.</span></span> <span data-ttu-id="c1c69-453">Это соглашение применяет указанный преобразователь параметров ко всем автоматически обнаруженным страницам Razor.</span><span class="sxs-lookup"><span data-stu-id="c1c69-453">This convention applies a specified parameter transformer to all automatically discovered Razor pages.</span></span> <span data-ttu-id="c1c69-454">Преобразователь параметров преобразует сегменты папок и имен файлов маршрутов страниц Razor.</span><span class="sxs-lookup"><span data-stu-id="c1c69-454">The parameter transformer transforms the folder and file name segments of Razor page routes.</span></span> <span data-ttu-id="c1c69-455">Дополнительные сведения см. в разделе об [использовании преобразователя параметров для настройки маршрутов страниц](/aspnet/core/razor-pages/razor-pages-conventions#use-a-parameter-transformer-to-customize-page-routes).</span><span class="sxs-lookup"><span data-stu-id="c1c69-455">For more information, see [Use a parameter transformer to customize page routes](/aspnet/core/razor-pages/razor-pages-conventions#use-a-parameter-transformer-to-customize-page-routes).</span></span>

::: moniker-end

## <a name="url-generation-reference"></a><span data-ttu-id="c1c69-456">Справочник по формированию URL-адресов</span><span class="sxs-lookup"><span data-stu-id="c1c69-456">URL generation reference</span></span>

<span data-ttu-id="c1c69-457">В приведенном ниже примере показано, как создать ссылку на маршрут с использованием словаря значений маршрута и коллекции <xref:Microsoft.AspNetCore.Routing.RouteCollection>.</span><span class="sxs-lookup"><span data-stu-id="c1c69-457">The following example shows how to generate a link to a route given a dictionary of route values and a <xref:Microsoft.AspNetCore.Routing.RouteCollection>.</span></span>

::: moniker range=">= aspnetcore-2.0"

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_Dictionary)]

::: moniker-end

::: moniker range="< aspnetcore-2.0"

[!code-csharp[](routing/samples/1.x/RoutingSample/Startup.cs?name=snippet_Dictionary)]

::: moniker-end

<span data-ttu-id="c1c69-458">В результате приведенного выше примера создается `VirtualPath` со значением `/package/create/123`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-458">The `VirtualPath` generated at the end of the preceding sample is `/package/create/123`.</span></span> <span data-ttu-id="c1c69-459">Словарь предоставляет значения маршрута `operation` и `id` шаблона "Отслеживание маршрута пакета", `package/{operation}/{id}`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-459">The dictionary supplies the `operation` and `id` route values of the "Track Package Route" template, `package/{operation}/{id}`.</span></span> <span data-ttu-id="c1c69-460">Дополнительные сведения см. в примере кода в разделе [Использование ПО промежуточного слоя маршрутизации](#use-routing-middleware) или в [примере приложения](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/routing/samples).</span><span class="sxs-lookup"><span data-stu-id="c1c69-460">For details, see the sample code in the [Use Routing Middleware](#use-routing-middleware) section or the [sample app](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/routing/samples).</span></span>

<span data-ttu-id="c1c69-461">Второй параметр конструктора `VirtualPathContext` — это коллекция *значений окружения*.</span><span class="sxs-lookup"><span data-stu-id="c1c69-461">The second parameter to the `VirtualPathContext` constructor is a collection of *ambient values*.</span></span> <span data-ttu-id="c1c69-462">Значения окружения упрощают разработку, ограничивая число значений, которые необходимо указывать в определенном контексте запроса.</span><span class="sxs-lookup"><span data-stu-id="c1c69-462">Ambient values provide convenience by limiting the number of values a developer must specify within a certain request context.</span></span> <span data-ttu-id="c1c69-463">Текущие значения маршрута текущего запроса считаются значениями окружения для создания ссылки.</span><span class="sxs-lookup"><span data-stu-id="c1c69-463">The current route values of the current request are considered ambient values for link generation.</span></span> <span data-ttu-id="c1c69-464">В приложении ASP.NET MVC в действии `About` контроллера `HomeController` не нужно задавать значение маршрута контроллера, указывающее на действие `Index` &mdash; используется значение окружения `Home`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-464">In an ASP.NET Core MVC app if you are in the `About` action of the `HomeController`, you don't need to specify the controller route value to link to the `Index` action&mdash;the ambient value of `Home` is used.</span></span>

<span data-ttu-id="c1c69-465">Значения окружения, которые не соответствуют параметру, игнорируются. Они также игнорируются при переопределении явно предоставленными значениями (значения следуют в URL-адресе слева направо).</span><span class="sxs-lookup"><span data-stu-id="c1c69-465">Ambient values that don't match a parameter are ignored, and ambient values are also ignored when an explicitly provided value overrides it, going from left to right in the URL.</span></span>

<span data-ttu-id="c1c69-466">Явно предоставленные значения, которым нет соответствий, добавляются в строку запроса.</span><span class="sxs-lookup"><span data-stu-id="c1c69-466">Values that are explicitly provided but which don't match anything are added to the query string.</span></span> <span data-ttu-id="c1c69-467">В приведенной ниже таблице показан результат использования шаблона маршрута `{controller}/{action}/{id?}`.</span><span class="sxs-lookup"><span data-stu-id="c1c69-467">The following table shows the result when using the route template `{controller}/{action}/{id?}`.</span></span>

| <span data-ttu-id="c1c69-468">Значения окружения</span><span class="sxs-lookup"><span data-stu-id="c1c69-468">Ambient Values</span></span>                | <span data-ttu-id="c1c69-469">Явные значения</span><span class="sxs-lookup"><span data-stu-id="c1c69-469">Explicit Values</span></span>                   | <span data-ttu-id="c1c69-470">Результат</span><span class="sxs-lookup"><span data-stu-id="c1c69-470">Result</span></span>                  |
| ----------------------------- | --------------------------------- | ----------------------- |
| <span data-ttu-id="c1c69-471">controller="Home"</span><span class="sxs-lookup"><span data-stu-id="c1c69-471">controller="Home"</span></span>             | <span data-ttu-id="c1c69-472">action="About"</span><span class="sxs-lookup"><span data-stu-id="c1c69-472">action="About"</span></span>                    | `/Home/About`           |
| <span data-ttu-id="c1c69-473">controller="Home"</span><span class="sxs-lookup"><span data-stu-id="c1c69-473">controller="Home"</span></span>             | <span data-ttu-id="c1c69-474">controller="Order",action="About"</span><span class="sxs-lookup"><span data-stu-id="c1c69-474">controller="Order",action="About"</span></span> | `/Order/About`          |
| <span data-ttu-id="c1c69-475">controller="Home",color="Red"</span><span class="sxs-lookup"><span data-stu-id="c1c69-475">controller="Home",color="Red"</span></span> | <span data-ttu-id="c1c69-476">action="About"</span><span class="sxs-lookup"><span data-stu-id="c1c69-476">action="About"</span></span>                    | `/Home/About`           |
| <span data-ttu-id="c1c69-477">controller="Home"</span><span class="sxs-lookup"><span data-stu-id="c1c69-477">controller="Home"</span></span>             | <span data-ttu-id="c1c69-478">action="About",color="Red"</span><span class="sxs-lookup"><span data-stu-id="c1c69-478">action="About",color="Red"</span></span>        | `/Home/About?color=Red` |

<span data-ttu-id="c1c69-479">Если маршрут имеет значение по умолчанию, которое не соответствует параметру, и это значение предоставлено явным образом, оно должно соответствовать значению по умолчанию:</span><span class="sxs-lookup"><span data-stu-id="c1c69-479">If a route has a default value that doesn't correspond to a parameter and that value is explicitly provided, it must match the default value:</span></span>

```csharp
routes.MapRoute("blog_route", "blog/{*slug}",
    defaults: new { controller = "Blog", action = "ReadPost" });
```

<span data-ttu-id="c1c69-480">Для этого маршрута ссылка будет создана только в том случае, если предоставлены соответствующие значения для контроллера и действия.</span><span class="sxs-lookup"><span data-stu-id="c1c69-480">Link generation only generates a link for this route when the matching values for controller and action are provided.</span></span>
